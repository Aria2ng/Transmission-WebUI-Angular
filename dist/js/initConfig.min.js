define(["jquery","lodash","transmission","angularAMD","angular-touch"],function(t,e,a,n){"use strict";var o=angular.module("transmission",["ngTouch"]),r=n.bootstrap(o);return r.config(["$touchProvider",function(t){t.ngClickOverrideEnabled([!0])}]),r.factory("ajaxService",["$http","$q",function(t,a){function n(e){var n=a.defer(),o=t({method:"POST",url:r+(void 0!==e.url?e.url:""),headers:void 0!==e.sessionId?{"X-Transmission-Session-Id":e.sessionId}:{},data:function(){var t={};switch(e.param.method){case"torrent-get":t=e.param;break;case"torrent-remove":t=e.param;break;default:t=e.param}return t}()});return a.when(o,function(t,e,a,o){n.resolve(t,e,a,o)},function(t,a){0!==a&&n.reject({errService:e.errService?e.errService:"Service Error",err:e.err,response:t,status:a})}),e.cancel===!0?n:n.promise}var o={},r="/transmission/rpc";o.getSession=function(t){return n({sessionId:t,param:{method:"session-get"},url:"?type=getSession"})},o.getSessionStats=function(t){return n({sessionId:t,param:{method:"session-stats"},url:"?type=getSessionStats"})};var s={all:["id"],torrentSame:["error","errorString","eta","isFinished","isStalled","leftUntilDone","metadataPercentComplete","peersConnected","peersGettingFromUs","peersSendingToUs","percentDone","queuePosition","rateDownload","rateUpload","recheckProgress","seedRatioMode","seedRatioLimit","sizeWhenDone","status","trackers","downloadDir","uploadedEver","uploadRatio","webseedsSendingToUs"],detailSame:["activityDate","corruptEver","desiredAvailable","downloadedEver","fileStats","haveUnchecked","haveValid","peers","startDate","trackerStats"]};return o.getTorrent=function(t){return n({sessionId:t,param:{method:"torrent-get",arguments:{fields:e.concat(s.all,s.torrentSame,["addedDate","name","totalSize"])}},url:"?type=getTorrent",cancel:!0})},o.getActiveTorrent=function(t){return n({sessionId:t,param:{method:"torrent-get",arguments:{fields:e.concat(s.all,s.torrentSame),ids:"recently-active"}},url:"?type=getActiveTorrent",cancel:!0})},o.getFullDetail=function(t,a){return n({sessionId:t,param:{method:"torrent-get",arguments:{fields:e.concat(s.all,s.detailSame,["comment","creator","dateCreated","files","hashString","isPrivate","pieceCount","pieceSize"]),ids:a}},url:"?type=getFullDetail",cancel:!0})},o.getDetail=function(t,a){return n({sessionId:t,param:{method:"torrent-get",arguments:{fields:e.concat(s.all,s.detailSame),ids:a}},url:"?type=getDetail",cancel:!0})},o.startTorrent=function(t){return n({sessionId:t,param:{method:"torrent-start"},url:"?type=startTorrent"})},o.stopTorrent=function(t){return n({sessionId:t,param:{method:"torrent-stop"},url:"?type=stopTorrent"})},o.removeFromList=function(t,e){return n({sessionId:t,param:{method:"torrent-remove",arguments:{ids:e}},url:"?type=removeFromList"})},o.removeAllData=function(t,e){return n({sessionId:t,param:{method:"torrent-remove",arguments:{"delete-local-data":!0,ids:e}},url:"?type=removeAllData"})},o.pauseTransform=function(t,e){return n({sessionId:t,param:{method:"torrent-stop",arguments:{ids:e}},url:"?type=torrent-stop"})},o.startTransform=function(t,e){return n({sessionId:t,param:{method:"torrent-start",arguments:{ids:e}},url:"?type=torrent-start"})},o.startTransformNow=function(t,e){return n({sessionId:t,param:{method:"torrent-start-now",arguments:{ids:e}},url:"?type=torrent-start-now"})},o}]),r.controller("mainController",["$scope","$http","$q","$sce","$timeout","ajaxService",function(n,o,r,s,l,i){n.getSession=function(t){i.getSession(t).then(function(t){n.data.global=t.data.arguments},function(t){var e=t.response.data,a="X-Transmission-Session-Id: ",o=e.indexOf(a),r=e.indexOf("</code>");n.data.session=e.substring(o+(a.length-1),r),n.$emit("getSessionDone")})},n.getStatsData=function(){i.getSessionStats(n.data.session).then(function(t){n.data.stats=t.data.arguments,n.$emit("getStatsDone")},function(t){console.log("查询stats失败")})},n.getRecentlyActiveTorrentData=function(){n.pool.ajax.activeTorrent=i.getActiveTorrent(n.data.session),n.pool.ajax.activeTorrent.promise.then(function(t){e.each(t.data.arguments.torrents,function(t,a){var o=e.findIndex(n.data.torrent,function(e){return e.id===t.id});o>-1&&e.merge(n.data.torrent[o],t)})},function(t){console.log("查询Torrent失败")})},n.sortTorrentData=function(){return n.data.torrent=e.sortBy(n.data.torrent,function(t){return-t.addedDate}),n.data.torrent},n.loopGetTorrentData=function(){n.pool.ajax.torrent=i.getTorrent(n.data.session),n.pool.ajax.torrent.promise.then(function(t){n.data.torrent=e.sortBy(t.data.arguments.torrents,function(t){return-t.addedDate}),n.data.ids=[],e.each(n.data.torrent,function(t,e){n.data.ids.push(t.id)}),n.pool.ajax.activeTorrent=n.getRecentlyActiveTorrentData(),n.pool.loop.activeTorrent=setInterval(function(){n.getRecentlyActiveTorrentData()},n.loopFragment.torrent)},function(t){console.log("查询Torrent失败")})},n.loopGetSessionData=function(){n.getSession(n.data.session),n.pool.loop.torrent=setInterval(function(){n.getSession(n.data.session)},n.loopFragment.session)},n.selectTorrent=function(t){return t!==n.data.selectedIndex&&(n.data.selectedIndex=t,void(n.detail.status===!0&&(n.detail.close(),n.detail.show())))},n.swip={left:function(){n.modal.status===!0;var e=t(window).width();e<=1024&&(n.consolePanel.status===!1&&n.detail.status===!1?n.detail.show():n.consolePanel.status===!0&&n.detail.status===!1&&n.consolePanel.close())},right:function(){var e=t(window).width();e<=1024&&(n.consolePanel.status===!1&&n.detail.status===!0?n.detail.close():n.consolePanel.status===!1&&n.detail.status===!1&&n.consolePanel.show())}},n.bytesConvert=function(t){var e={data:t,band:1e3};return a.bytesConvert(e)},n.parseFloat2=function(t){return a.parseFloat2(t)},n.parsTorrentClassName=function(t,e){var a="";switch(t){case 0:a="paused";break;case 4:a="downloading";break;case 6:a="seeding";break;default:a="seeding"}return e===n.data.selectedIndex&&(a+=" selected"),a},n.parseEta=function(t){var e="";return e=t===-1?"不可用":t===-2?"无法预估":a.secondsToTime(t)},n.parseFloat2=function(t){return a.parseFloat2(t)},n.getStatusText=function(t){var e="";switch(t.status){case 0:e=t.metaComplete<1?"磁性链接下载元数据中":"已暂停";break;case 4:e="下载中";break;case 6:e="做种中"}return e},n.howLong=function(t){return n.parseEta(parseInt((new Date).getTime()/1e3)-t)},n.getFullDate=function(t){return a.parseFullDate(t)},n.parseText={Status:function(t){var e=n.data.torrent[t],a="";switch(e.status){case 0:a+="已暂停";break;case 4:a+="下载自",a+="<span>"+e.peersSendingToUs+"/"+e.peersConnected+"个用户</span>",a+='<span class="icon-download">',a+=n.bytesConvert(e.rateDownload)+"/s",a+="</span>",a+='<span class="icon-upload">',a+=n.bytesConvert(e.rateUpload)+"/s",a+="</span>";break;case 6:a+="分享至",a+="<span>"+e.peersGettingFromUs+"/"+e.peersConnected+"个用户</span>",a+='<span class="icon-upload">',a+=n.bytesConvert(e.rateUpload)+"/s",a+="</span>"}return s.trustAsHtml(a)},TransformData:function(t){var e=n.data.torrent[t],o="";switch(e.status){case 0:e.metadataPercentComplete<1?(o+="磁性链接",o+="<span>",o+="下载元数据（"+(e.metadataPercentComplete<1?a.parseFloat2(100*e.metadataPercentComplete):"100")+"%）",o+="</span>"):(o+="已下载",o+="<span>",o+=n.bytesConvert(e.totalSize*(e.percentDone<1?e.percentDone:1))+"/"+n.bytesConvert(e.totalSize),o+="</span>",o+="<span>",o+="("+(e.percentDone<1?a.parseFloat2(100*e.percentDone):"100")+"%)",o+="</span>");break;case 4:e.metadataPercentComplete<1?o+="磁性链接<span> 下载元数据（"+(e.metadataPercentComplete<1?a.parseFloat2(100*e.metadataPercentComplete):"100")+"）</span>":(o+="已下载",o+="<span>",o+=n.bytesConvert(e.totalSize*(e.percentDone<1?e.percentDone:1))+"/"+n.bytesConvert(e.totalSize),o+="</span>",o+="<span>",o+="("+(e.percentDone<1?a.parseFloat2(100*e.percentDone):"100")+"%)",o+="</span>",e.uploadedEver>0&&(o+="<span>",o+="已上传",o+="</span>",o+="<span>",o+=n.bytesConvert(e.uploadedEver),o+="</span>"),o+="<span>",o+="预估剩余时间："+n.parseEta(e.eta),o+="</span>");break;case 6:o+="已上传",o+="<span>",o+=n.bytesConvert(e.uploadedEver)+"/"+n.bytesConvert(e.totalSize),o+="</span>",o+="<span>",o+="分享率("+a.parseFloat2(e.uploadRatio)+"%)",o+="</span>",o+="<span>",o+="预估剩余时间："+n.parseEta(e.eta),o+="</span>"}return s.trustAsHtml(o)}},n.detail={target:t("#torrent-detail"),className:"show",tabNames:["info","peers","tracker","files"],tabSelect:function(t){n.detail.selectedTabIndex=t},status:!1,torrentData:!1,selectedTabIndex:0,show:function(){n.detail.status=n.detail.status!==!0,n.detail.status===!0?""!==n.data.selectedIndex&&(n.detail.torrentData=n.data.torrent[n.data.selectedIndex],n.pool.ajax.fullDetail=i.getFullDetail(n.data.session,[n.data.torrent[n.data.selectedIndex].id]),n.pool.ajax.fullDetail.promise.then(function(t){n.data.detail=t.data.arguments.torrents[0],n.pool.loop.detail=setInterval(function(){n.pool.ajax.detail=i.getDetail(n.data.session,[n.data.torrent[n.data.selectedIndex].id]),n.pool.ajax.detail.promise.then(function(t){n.data.detail=e.merge(n.data.detail,t.data.arguments.torrents[0])},function(t){console.log("维护明细数据失败")})},n.loopFragment.detail)},function(t){console.log("获取明细失败")})):n.detail.close()},close:function(){clearInterval(n.pool.loop.detail),n.detail.status=!1,n.closeAjax(n.pool.ajax.fullDetail),n.closeAjax(n.pool.ajax.detail)}},n.closeAjax=function(t){"object"==typeof t&&"function"==typeof t.resolve&&t.resolve()},n.reload={torrent:function(){clearInterval(n.pool.loop.activeTorrent),n.closeAjax(n.pool.ajax.torrent),n.closeAjax(n.pool.ajax.activeTorrent),n.loopGetTorrentData()},detail:function(){clearInterval(n.pool.loop.detail),n.closeAjax(n.pool.ajax.fullDetail),n.closeAjax(n.pool.ajax.detail)}};var d=function(e){var a=!0;return(0===n.data.torrent.length||void 0===e||0===e.length||1===e.length&&void 0===e[0])&&(a=!1),t(window).width()<=1024&&(n.consolePanel.status=!1),a};n.removeFromList=function(t){return d(t)!==!1&&void i.removeFromList(n.data.session,t).then(function(t){n.reload.torrent()},function(t){console.log("从下载列表中移除失败")})},n.removeFromList=function(t){return d(t)!==!1&&void i.removeAllData(n.data.session,t).then(function(t){n.reload.torrent()},function(t){console.log("从下载列表中移除失败")})},n.pauseTransform=function(t){return d(t)!==!1&&void i.pauseTransform(n.data.session,t).then(function(t){n.reload.torrent()},function(t){console.log("暂停传输任务请求失败！")})},n.startTransform=function(t){return d(t)!==!1&&void i.startTransform(n.data.session,t).then(function(t){n.reload.torrent()},function(t){console.log("暂停传输任务请求失败！")})},n.startTransformNow=function(t){return d(t)!==!1&&void i.startTransformNow(n.data.session,t).then(function(t){n.reload.torrent()},function(t){console.log("暂停传输任务请求失败！")})},n.consolePanel={status:!1,show:function(){n.consolePanel.status=!0},close:function(){n.consolePanel.status=!1}},n.modal={status:!1,isNeedTitle:!1,type:"add",size:"big",title:"测试标题",content:"添加传输任务失败！",btnType:2,btnText:{submit:"确定",cancel:"关闭"},submitFunc:function(){n.modal.close()},show:function(){var e="alpha";n.modal.status=n.modal.status!==!0,l(function(){t("#modal-bg").addClass(e),t("#modal").addClass(e)},100)},close:function(){var e="alpha";t("#modal-bg").removeClass(e),t("#modal").removeClass(e),l(function(){n.modal.status=!1},550)}},t(document).click(function(){n.modal.close()}),n.init=function(){if(n.loopFragment={torrent:5e3,active:5e3,detail:5e3,session:15e3},n.pool={loop:{torrent:"",activeTorrent:"",session:"",detail:""},ajax:{torrent:{},activeTorrent:{},detail:{},fullDetail:{}}},n.data={session:"",global:{},torrent:[],selectedIndex:"",stats:{},ids:[],detail:{}},n.localMode=!0,n.localMode===!0){var t=r.defer();require(["localData"],function(e){t.resolve(e)}),t.promise.then(function(t){n.data={global:t.global,torrent:t.torrent,selectedIndex:t.selectedIndex,stats:t.stats,ids:t.ids,detail:t.detail}},function(t){})}var e=setInterval(function(){n.getSession()},3e3);n.$on("getSessionDone",function(t){clearInterval(e),n.loopGetSessionData(),n.getStatsData()}),n.$on("getStatsDone",function(){n.loopGetTorrentData()}),n.tmpUrl={detail:"template/detail.html",blankDetail:"template/blankdetail.html",tips:"template/tips.html",settings:"template/settings.html",modal:"template/tips.html"},document.addEventListener("touchstart",function(t){t.cancelable&&(t.defaultPrevented||t.preventDefault())},!1)},n.init()}]),r.directive("includeReplace",function(){return{require:"ngInclude",restrict:"A",link:function(t,e,a){e.replaceWith(e.children())}}}),r});
//# sourceMappingURL=maps/initConfig.min.js.map
