define(["jquery","lodash","transmission","angularAMD","angular-touch"],function(t,e,a,o){"use strict";var n=angular.module("transmission",["ngTouch"]),r=o.bootstrap(n);return r.config(["$touchProvider",function(t){t.ngClickOverrideEnabled([!0])}]),r.factory("ajaxService",["$http","$q",function(t,a){function o(e){var o=a.defer(),n=t({method:"POST",url:r+(void 0!==e.url?e.url:""),headers:void 0!==e.sessionId?{"X-Transmission-Session-Id":e.sessionId}:{},data:function(){var t={};switch(e.param.method){case"torrent-get":t=e.param;break;case"torrent-remove":t=e.param;break;default:t=e.param}return t}()});return a.when(n,function(t,e,a,n){o.resolve(t,e,a,n)},function(t,a){0!==a&&o.reject({errService:e.errService?e.errService:"Service Error",err:e.err,response:t,status:a})}),e.cancel===!0?o:o.promise}var n={},r="/transmission/rpc";n.getSession=function(t){return o({sessionId:t,param:{method:"session-get"},url:"?type=getSession"})},n.getSessionStats=function(t){return o({sessionId:t,param:{method:"session-stats"},url:"?type=getSessionStats"})};var s={all:["id"],torrentSame:["error","errorString","eta","isFinished","isStalled","leftUntilDone","metadataPercentComplete","peersConnected","peersGettingFromUs","peersSendingToUs","percentDone","queuePosition","rateDownload","rateUpload","recheckProgress","seedRatioMode","seedRatioLimit","sizeWhenDone","status","trackers","downloadDir","uploadedEver","uploadRatio","webseedsSendingToUs"],detailSame:["activityDate","corruptEver","desiredAvailable","downloadedEver","fileStats","haveUnchecked","haveValid","peers","startDate","trackerStats"]};return n.getTorrent=function(t){return o({sessionId:t,param:{method:"torrent-get",arguments:{fields:e.concat(s.all,s.torrentSame,["addedDate","name","totalSize"])}},url:"?type=getTorrent",cancel:!0})},n.getActiveTorrent=function(t){return o({sessionId:t,param:{method:"torrent-get",arguments:{fields:e.concat(s.all,s.torrentSame),ids:"recently-active"}},url:"?type=getActiveTorrent",cancel:!0})},n.getFullDetail=function(t,a){return o({sessionId:t,param:{method:"torrent-get",arguments:{fields:e.concat(s.all,s.detailSame,["comment","creator","dateCreated","files","hashString","isPrivate","pieceCount","pieceSize"]),ids:a}},url:"?type=getFullDetail",cancel:!0})},n.getDetail=function(t,a){return o({sessionId:t,param:{method:"torrent-get",arguments:{fields:e.concat(s.all,s.detailSame),ids:a}},url:"?type=getDetail",cancel:!0})},n.startTorrent=function(t){return o({sessionId:t,param:{method:"torrent-start"},url:"?type=startTorrent"})},n.stopTorrent=function(t){return o({sessionId:t,param:{method:"torrent-stop"},url:"?type=stopTorrent"})},n.removeFromList=function(t,e){return o({sessionId:t,param:{method:"torrent-remove",arguments:{ids:e}},url:"?type=removeFromList"})},n.removeAllData=function(t,e){return o({sessionId:t,param:{method:"torrent-remove",arguments:{"delete-local-data":!0,ids:e}},url:"?type=removeAllData"})},n.pauseTransform=function(t,e){return o({sessionId:t,param:{method:"torrent-stop",arguments:{ids:e}},url:"?type=torrent-stop"})},n.startTransform=function(t,e){return o({sessionId:t,param:{method:"torrent-start",arguments:{ids:e}},url:"?type=torrent-start"})},n.startTransformNow=function(t,e){return o({sessionId:t,param:{method:"torrent-start-now",arguments:{ids:e}},url:"?type=torrent-start-now"})},n}]),r.controller("mainController",["$scope","$http","$q","$sce","$timeout","ajaxService",function(o,n,r,s,l,i){var d=0,c="";o.getSession=function(t){i.getSession(t).then(function(t){o.dataStorage.global=t.data.arguments},function(t){var e=t.response.data,a="X-Transmission-Session-Id: ",n=e.indexOf(a),r=e.indexOf("</code>");if(n!==-1&&r!==-1)o.dataStorage.session=e.substring(n+(a.length-1),r),o.$emit("getSessionDone");else if(d+=1,1===d)c=(new Date).getTime();else if(5===d){var s=(new Date).getTime();c-s<=6e4?o.modal.show({type:"waring",content:"一分钟内请求Session失败次数过多，请检查网络或点击确定重新加载！",size:"small",btnType:2,submitFunc:function(){}}):d=0}})},o.getStatsData=function(){i.getSessionStats(o.dataStorage.session).then(function(t){o.dataStorage.stats=t.data.arguments,o.dataStorage.totalSpeed.download=o.dataStorage.stats.downloadSpeed,o.dataStorage.totalSpeed.upload=o.dataStorage.stats.uploadSpeed,o.$emit("getStatsDone")},function(t){console.log("查询stats失败")})},o.getRecentlyActiveTorrentData=function(){o.pool.ajax.activeTorrent=i.getActiveTorrent(o.dataStorage.session),o.pool.ajax.activeTorrent.promise.then(function(t){e.each(t.data.arguments.torrents,function(t,a){var n=e.findIndex(o.dataStorage.torrent,function(e){return e.id===t.id});n>-1&&e.merge(o.dataStorage.torrent[n],t)}),o.getTotalSpeed()},function(t){console.log("查询Torrent失败")})},o.sortTorrentData=function(){return o.dataStorage.torrent=e.sortBy(o.dataStorage.torrent,function(t){return-t.addedDate}),o.getTotalSpeed(),o.dataStorage.torrent},o.loopGetTorrentData=function(){o.pool.ajax.torrent=i.getTorrent(o.dataStorage.session),o.pool.ajax.torrent.promise.then(function(t){o.dataStorage.torrent=e.sortBy(t.data.arguments.torrents,function(t){return-t.addedDate}),o.dataStorage.ids=[],e.each(o.dataStorage.torrent,function(t,e){o.dataStorage.ids.push(t.id)}),o.pool.ajax.activeTorrent=o.getRecentlyActiveTorrentData(),o.pool.loop.activeTorrent=setInterval(function(){o.getRecentlyActiveTorrentData()},o.loopFragment.torrent)},function(t){console.log("查询Torrent失败")})},o.loopGetSessionData=function(){o.getSession(o.dataStorage.session),o.pool.loop.torrent=setInterval(function(){o.getSession(o.dataStorage.session)},o.loopFragment.session)},o.selectTorrent=function(t){return t!==o.dataStorage.selectedIndex&&(o.dataStorage.selectedIndex=t,void(o.detail.status===!0&&(o.detail.close(),o.detail.show())))},o.swip={left:function(){return o.modal.status!==!0&&void(o.getScreenWidth()<=1024&&(o.consolePanel.status===!1&&o.detail.status===!1?o.detail.show():o.consolePanel.status===!0&&o.detail.status===!1&&o.consolePanel.close()))},right:function(){return o.modal.status!==!0&&void(o.getScreenWidth()<=1024&&(o.consolePanel.status===!1&&o.detail.status===!0?o.detail.close():o.consolePanel.status===!1&&o.detail.status===!1&&o.consolePanel.show()))}},o.bytesConvert=function(t){var e={data:t,band:1e3};return a.bytesConvert(e)},o.parseFloat2=function(t){return a.parseFloat2(t)},o.parsTorrentClassName=function(t,e){var a="";switch(t){case 0:a="paused";break;case 4:a="downloading";break;case 6:a="seeding";break;default:a="seeding"}return e===o.dataStorage.selectedIndex&&(a+=" selected"),a},o.parseEta=function(t){var e="";return e=t===-1?"不可用":t===-2?"无法预估":a.secondsToTime(t)},o.parseFloat2=function(t){return a.parseFloat2(t)},o.getStatusText=function(t){var e="";switch(t.status){case 0:e=t.metaComplete<1?"磁性链接下载元数据中":"已暂停";break;case 4:e="下载中";break;case 6:e="做种中"}return e},o.howLong=function(t){return o.parseEta(parseInt((new Date).getTime()/1e3)-t)},o.getFullDate=function(t){return a.parseFullDate(t)},o.parseText={Status:function(t){var e=o.dataStorage.torrent[t],a="";switch(e.status){case 0:a+="已暂停";break;case 4:a+="下载自",a+="<span>"+e.peersSendingToUs+"/"+e.peersConnected+"个用户</span>",a+='<span class="icon-download">',a+=o.bytesConvert(e.rateDownload)+"/s",a+="</span>",a+='<span class="icon-upload">',a+=o.bytesConvert(e.rateUpload)+"/s",a+="</span>";break;case 6:a+="分享至",a+="<span>"+e.peersGettingFromUs+"/"+e.peersConnected+"个用户</span>",a+='<span class="icon-upload">',a+=o.bytesConvert(e.rateUpload)+"/s",a+="</span>"}return s.trustAsHtml(a)},TransformData:function(t){var e=o.dataStorage.torrent[t],n="";switch(e.status){case 0:e.metadataPercentComplete<1?(n+="磁性链接",n+="<span>",n+="下载元数据（"+(e.metadataPercentComplete<1?a.parseFloat2(100*e.metadataPercentComplete):"100")+"%）",n+="</span>"):(n+="已下载",n+="<span>",n+=o.bytesConvert(e.totalSize*(e.percentDone<1?e.percentDone:1))+"/"+o.bytesConvert(e.totalSize),n+="</span>",n+="<span>",n+="("+(e.percentDone<1?a.parseFloat2(100*e.percentDone):"100")+"%)",n+="</span>");break;case 4:e.metadataPercentComplete<1?n+="磁性链接<span> 下载元数据（"+(e.metadataPercentComplete<1?a.parseFloat2(100*e.metadataPercentComplete):"100")+"）</span>":(n+="已下载",n+="<span>",n+=o.bytesConvert(e.totalSize*(e.percentDone<1?e.percentDone:1))+"/"+o.bytesConvert(e.totalSize),n+="</span>",n+="<span>",n+="("+(e.percentDone<1?a.parseFloat2(100*e.percentDone):"100")+"%)",n+="</span>",e.uploadedEver>0&&(n+="<span>",n+="已上传",n+="</span>",n+="<span>",n+=o.bytesConvert(e.uploadedEver),n+="</span>"),o.getScreenWidth()>1024&&(n+="<span>",n+="预估剩余时间："+o.parseEta(e.eta),n+="</span>"));break;case 6:n+="已上传",n+="<span>",n+=o.bytesConvert(e.uploadedEver)+"/"+o.bytesConvert(e.totalSize),n+="</span>",n+="<span>",n+="分享率("+a.parseFloat2(e.uploadRatio)+"%)",n+="</span>",o.getScreenWidth()>1024&&(n+="<span>",n+="预估剩余时间："+o.parseEta(e.eta),n+="</span>")}return s.trustAsHtml(n)}},o.detail={target:t("#torrent-detail"),className:"show",tabNames:["info","peers","tracker","files"],tabSelect:function(t){o.detail.selectedTabIndex=t},status:!1,torrentData:!1,selectedTabIndex:0,show:function(){o.detail.status=o.detail.status!==!0,o.detail.status===!0?""!==o.dataStorage.selectedIndex&&(o.detail.torrentData=o.dataStorage.torrent[o.dataStorage.selectedIndex],o.pool.ajax.fullDetail=i.getFullDetail(o.dataStorage.session,[o.dataStorage.torrent[o.dataStorage.selectedIndex].id]),o.pool.ajax.fullDetail.promise.then(function(t){o.dataStorage.detail=t.data.arguments.torrents[0],o.pool.loop.detail=setInterval(function(){o.pool.ajax.detail=i.getDetail(o.dataStorage.session,[o.dataStorage.torrent[o.dataStorage.selectedIndex].id]),o.pool.ajax.detail.promise.then(function(t){o.dataStorage.detail=e.merge(o.dataStorage.detail,t.data.arguments.torrents[0])},function(t){console.log("维护明细数据失败")})},o.loopFragment.detail)},function(t){console.log("获取明细失败")})):o.detail.close()},close:function(){clearInterval(o.pool.loop.detail),o.detail.status=!1,o.closeAjax(o.pool.ajax.fullDetail),o.closeAjax(o.pool.ajax.detail)}},o.closeAjax=function(t){"object"==typeof t&&"function"==typeof t.resolve&&t.resolve()},o.reload={torrent:function(){clearInterval(o.pool.loop.activeTorrent),o.closeAjax(o.pool.ajax.torrent),o.closeAjax(o.pool.ajax.activeTorrent),o.loopGetTorrentData()},detail:function(){clearInterval(o.pool.loop.detail),o.closeAjax(o.pool.ajax.fullDetail),o.closeAjax(o.pool.ajax.detail)}};var u=function(e){var a=!0;return(0===o.dataStorage.torrent.length||void 0===e||0===e.length||1===e.length&&void 0===e[0])&&(a=!1),t(window).width()<=1024&&(o.consolePanel.status=!1),a};o.removeFromList=function(t){return u(t)!==!1&&void i.removeFromList(o.dataStorage.session,t).then(function(t){o.reload.torrent()},function(t){console.log("从下载列表中移除失败")})},o.removeFromList=function(t){return u(t)!==!1&&void i.removeAllData(o.dataStorage.session,t).then(function(t){o.reload.torrent()},function(t){console.log("从下载列表中移除失败")})},o.pauseTransform=function(t){return u(t)!==!1&&void i.pauseTransform(o.dataStorage.session,t).then(function(t){o.reload.torrent()},function(t){console.log("暂停传输任务请求失败！")})},o.startTransform=function(t){return u(t)!==!1&&void i.startTransform(o.dataStorage.session,t).then(function(t){o.reload.torrent()},function(t){console.log("暂停传输任务请求失败！")})},o.startTransformNow=function(t){return u(t)!==!1&&void i.startTransformNow(o.dataStorage.session,t).then(function(t){o.reload.torrent()},function(t){console.log("暂停传输任务请求失败！")})},o.consolePanel={status:!1,show:function(){o.consolePanel.status=!0},close:function(){o.consolePanel.status=!1}},o.modal={status:!1,isNeedTitle:!1,type:"add",size:"big",title:"测试标题",content:"添加传输任务失败！",btnType:2,btnText:{submit:"确定",cancel:"关闭"},submitFunc:function(){o.modal.close()},show:function(a,n){a.stopPropagation();var r="alpha";void 0!==n&&e.each(n,function(t,e){"show"!==e&&"close"!==e&&(o.modal[e]=t)}),o.modal.status=o.modal.status!==!0,l(function(){t("#modal-bg").addClass(r),t("#modal").addClass(r)},100)},close:function(){var e="alpha";t("#modal-bg").removeClass(e),t("#modal").removeClass(e),l(function(){o.modal.status=!1},550)}},t(document).click(function(){o.modal.status===!0&&o.modal.close()}),o.nav={status:!1,menudata:{name:["设置","计划任务运行","收缩视图","查看传输明细"],className:["icon-settings","icon-scheduled","icon-listview","icon-info-black"]},toggle:function(){o.nav.status=o.nav.status!==!0},close:function(t){o.nav.status=!1}},o.getTotalSpeed=function(){var t={download:0,upload:0};e.each(o.dataStorage.torrent,function(e,a){t.download+=void 0===e.rateDownload||null===e.rateDownload?0:e.rateDownload,t.upload+=void 0===e.rateUpload||null===e.rateUpload?0:e.rateUpload}),o.dataStorage.totalSpeed.download=t.download,o.dataStorage.totalSpeed.upload=t.upload},o.init=function(){if(o.loopFragment={torrent:5e3,active:5e3,detail:5e3,session:15e3},o.getScreenWidth=function(){return t(window).width()},o.pool={loop:{torrent:"",activeTorrent:"",session:"",detail:""},ajax:{torrent:{},activeTorrent:{},detail:{},fullDetail:{},sessionStats:{},session:{},remove:{},add:{},pause:{}}},o.dataStorage={session:"",global:{},torrent:[],selectedIndex:"",stats:{},ids:[],detail:{},test:0,totalSpeed:{download:0,upload:0}},o.localMode=!0,o.localMode===!0){var e=r.defer();require(["localData"],function(t){e.resolve(t)}),e.promise.then(function(t){o.data={global:t.global,torrent:t.torrent,selectedIndex:t.selectedIndex,stats:t.stats,ids:t.ids,detail:t.detail},o.getTotalSpeed()},function(t){})}var a=setInterval(function(){o.getSession()},3e3);o.$on("getSessionDone",function(t){clearInterval(a),o.loopGetSessionData(),o.getStatsData()}),o.$on("getStatsDone",function(){o.loopGetTorrentData()}),o.tmpUrl={detail:"template/detail.html",blankDetail:"template/blankdetail.html",tips:"template/tips.html",settings:"template/settings.html",modal:"template/tips.html"},document.addEventListener("touchstart",function(t){t.cancelable&&(t.defaultPrevented||t.preventDefault())},!1)},o.init()}]),r.directive("includeReplace",function(){return{require:"ngInclude",restrict:"A",link:function(t,e,a){e.replaceWith(e.children())}}}),r});
//# sourceMappingURL=maps/initConfig.min.js.map
