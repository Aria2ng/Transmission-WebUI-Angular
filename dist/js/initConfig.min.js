define(["jquery","lodash","transmission","angularAMD","mnTouch"],function(t,e,a,o){"use strict";var n=angular.module("transmission",["mn"]),r=o.bootstrap(n);return r.factory("ajaxService",["$http","$q",function(t,a){function o(e){var o=a.defer(),n=t({method:"POST",url:r+(void 0!==e.url?e.url:""),headers:void 0!==e.sessionId?{"X-Transmission-Session-Id":e.sessionId}:{},data:function(){var t={};switch(e.param.method){case"torrent-get":t=e.param;break;case"torrent-remove":t=e.param;break;default:t=e.param}return t}()});return a.when(n,function(t,e,a,n){o.resolve(t,e,a,n)},function(t,a){0!==a&&o.reject({errService:e.errService?e.errService:"Service Error",err:e.err,response:t,status:a})}),e.cancel===!0?o:o.promise}var n={},r="/transmission/rpc";n.getSession=function(t){return o({sessionId:t,param:{method:"session-get"},url:"?type=getSession",cancel:!0})},n.getSessionStats=function(t){return o({sessionId:t,param:{method:"session-stats"},url:"?type=getSessionStats"})};var s={all:["id"],torrentSame:["error","errorString","eta","isFinished","isStalled","leftUntilDone","metadataPercentComplete","peersConnected","peersGettingFromUs","peersSendingToUs","percentDone","queuePosition","rateDownload","rateUpload","recheckProgress","seedRatioMode","seedRatioLimit","sizeWhenDone","status","trackers","downloadDir","uploadedEver","uploadRatio","webseedsSendingToUs"],detailSame:["activityDate","corruptEver","desiredAvailable","downloadedEver","fileStats","haveUnchecked","haveValid","peers","startDate","trackerStats"]};return n.getTorrent=function(t){return o({sessionId:t,param:{method:"torrent-get",arguments:{fields:e.concat(s.all,s.torrentSame,["addedDate","name","totalSize"])}},url:"?type=getTorrent",cancel:!0})},n.getActiveTorrent=function(t){return o({sessionId:t,param:{method:"torrent-get",arguments:{fields:e.concat(s.all,s.torrentSame),ids:"recently-active"}},url:"?type=getActiveTorrent",cancel:!0})},n.getFullDetail=function(t,a){return o({sessionId:t,param:{method:"torrent-get",arguments:{fields:e.concat(s.all,s.detailSame,["comment","creator","dateCreated","files","hashString","isPrivate","pieceCount","pieceSize"]),ids:a}},url:"?type=getFullDetail",cancel:!0})},n.getDetail=function(t,a){return o({sessionId:t,param:{method:"torrent-get",arguments:{fields:e.concat(s.all,s.detailSame),ids:a}},url:"?type=getDetail",cancel:!0})},n.addTransform=function(t,e){return o({sessionId:t,param:{method:"torrent-add",arguments:e},url:"?type=torrent-add"})},n.startTorrent=function(t){return o({sessionId:t,param:{method:"torrent-start"},url:"?type=startTorrent"})},n.stopTorrent=function(t){return o({sessionId:t,param:{method:"torrent-stop"},url:"?type=stopTorrent"})},n.removeFromList=function(t,e){return o({sessionId:t,param:{method:"torrent-remove",arguments:{ids:e}},url:"?type=removeFromList"})},n.removeAllData=function(t,e){return o({sessionId:t,param:{method:"torrent-remove",arguments:{"delete-local-data":!0,ids:e}},url:"?type=removeAllData"})},n.pauseTransform=function(t,e){return o({sessionId:t,param:{method:"torrent-stop",arguments:{ids:e}},url:"?type=torrent-stop"})},n.startTransform=function(t,e){return o({sessionId:t,param:{method:"torrent-start",arguments:{ids:e}},url:"?type=torrent-start"})},n.startTransformNow=function(t,e){return o({sessionId:t,param:{method:"torrent-start-now",arguments:{ids:e}},url:"?type=torrent-start-now"})},n.portTest=function(t){return o({sessionId:t,param:{method:"port-test"},url:"?type=port-test"})},n.saveSettings=function(t,e){return o({sessionId:t,param:{method:"session-set",arguments:e},url:"?type=saveSettings"})},n.setPriority=function(t,e){return o({sessionId:t,param:{method:"torrent-set",arguments:function(){var t={ids:e.idsArr};return t[e.priorityType]=e.priorityIndexArr,t}()},url:"?type=torrent-set"})},n}]),r.controller("mainController",["$scope","$http","$q","$sce","$timeout","$window","$document","$compile","ajaxService",function(o,n,r,s,i,l,d,p,c){var u="template/";o.detailTemplateLoaded=!1,o.tmpUrl={detail:u+"detail.html",tips:"modal_t",settings:"settings",modal:"modal_t",about:"about",statics:"statics",addFiles:"addFiles"},o.pool={loop:{torrent:0,activeTorrent:0,session:0,sessionStats:0,detail:0,detailSpeedChart:0},ajax:{torrent:{},activeTorrent:{},detail:{},fullDetail:{},sessionStats:{},session:{},remove:{},add:{},pause:{}}},o.dataStorage={session:"",globalOrignal:{},global:{"alt-speed-down":0,"alt-speed-up":0,"alt-speed-time-begin":0,"alt-speed-time-end":0,"alt-speed-time-day":127},torrent:[],selectedIndex:"",stats:{},ids:[],detail:{},settings:{},"port-test":!1,searchText:{name:""},totalSpeed:{download:0,upload:0},"speed-limit-times":function(){for(var t=[],e=0,a=function(t){var e="",a=0,o=0;return t<60?e="00:"+(t<10?"0"+t:t):(a=parseInt(t/60),o=t-60*a,e=(a<10?"0"+a:a)+":"+(0===o?"00":o)),e},o=0;o<96;o++)t.push({key:a(e),value:e}),e+=15;return t}(),"speed-limit-day":[{key:"每天",value:127},{key:"工作日",value:62},{key:"周末",value:65},{key:"星期天",value:1},{key:"星期一",value:2},{key:"星期二",value:4},{key:"星期三",value:8},{key:"星期四",value:16},{key:"星期五",value:32},{key:"星期六",value:64}],encryption:[{key:"允许加密",value:"tolerated"},{key:"喜欢加密",value:"preferred"},{key:"需要加密",value:"required"}],addTransform:{metainfo:[],filename:"","download-dir":"123123",paused:!0}},o.loopFragment={torrent:5e3,active:5e3,detail:5e3,session:15e3},o.speedChartData={xAxis:[],download:[],upload:[]};var m=0,g="";o.getSession=function(t){o.pool.ajax.session=c.getSession(t),o.pool.ajax.session.promise.then(function(t){m=0,o.dataStorage.global=t.data.arguments},function(t){var e=!0,a=t.response.data;if(null===a&&(e=!1),e===!0){var n="X-Transmission-Session-Id: ",r=a.indexOf(n),s=a.indexOf("</code>");r!==-1&&s!==-1?(o.dataStorage.session=a.substring(r+(n.length-1),s),o.$emit("getSessionDone")):e=!1}if(e===!1)if(m+=1,1===m)g=(new Date).getTime();else if(m>=5){var i=(new Date).getTime();i-g<=18e4?(o.stopAllAjax(),o.modal.show({type:"waring",title:"一分钟内请求Session失败次数过多",content:"请检查您的网络是否顺畅，或点击刷新尝试解决！",btnText:{submit:"刷新"},btnType:2,submitFunc:function(){l.location.reload()}})):(m=0,g=(new Date).getTime())}})},o.loopGetSession=function(){o.getSession(o.dataStorage.session),o.pool.loop.session=setInterval(function(){o.getSession(o.dataStorage.session)},o.loopFragment.session)},o.getStatsData=function(t){o.pool.ajax.sessionStats=c.getSessionStats(o.dataStorage.session).then(function(e){o.dataStorage.stats=e.data.arguments,"init"===t&&(o.dataStorage.totalSpeed.download=o.dataStorage.stats.downloadSpeed,o.dataStorage.totalSpeed.upload=o.dataStorage.stats.uploadSpeed,o.$emit("getStatsDone"))},function(t){o.modal.show({type:"waring",title:"查询统计数据失败",content:"请检查您的网络是否顺畅，或点击重载尝试重新加载一次统计数据！",btnText:{submit:"重载"},btnType:2,submitFunc:function(){o.getStatsData()}})})};var f=0,h=0;o.getRecentlyActiveTorrentData=function(){o.pool.ajax.activeTorrent=c.getActiveTorrent(o.dataStorage.session),o.pool.ajax.activeTorrent.promise.then(function(t){f=0,e.each(t.data.arguments.torrents,function(t,a){var n=e.findIndex(o.dataStorage.torrent,function(e){return e.id===t.id});n>-1&&e.merge(o.dataStorage.torrent[n],t)});var n={oldMax:{download:o.dataStorage.totalSpeed.download,upload:o.dataStorage.totalSpeed.upload},newMax:{download:0,upload:0}};if(o.getTotalSpeed(),n.newMax.download=o.dataStorage.totalSpeed.download,n.newMax.upload=o.dataStorage.totalSpeed.upload,void 0!==o.speedChart&&o.detail.status===!0){var r={xAxis:[{data:function(){var t=(new Date).getTime();return o.speedChartData.xAxis.splice(0,1),o.speedChartData.xAxis.push({value:a.getFullTime(t),textStyle:{align:"right"}}),o.speedChartData.xAxis}()}],yAxia:[{data:parseFloat(a.bytesConvert({data:o.dataStorage.totalSpeed.download,band:1024,spliceUnit:!0}).num)},{data:parseFloat(a.bytesConvert({data:o.dataStorage.totalSpeed.upload,band:1024,spliceUnit:!0}).num)}],series:[{data:function(){return o.speedChartData.download.splice(0,1),o.speedChartData.download.push(a.bytesConvert({data:o.detail.torrentData.rateDownload,band:1024,spliceUnit:!0}).num),o.speedChartData.download}()},{data:function(){return o.speedChartData.upload.splice(0,1),o.speedChartData.upload.push(a.bytesConvert({data:o.detail.torrentData.rateUpload,band:1024,spliceUnit:!0}).num),o.speedChartData.upload}()}]};n.oldMax.download===n.newMax.download&&n.oldMax.upload===n.newMax.upload||(r.yAxia=[{max:n.oldMax.download},{max:n.oldMax.upload}],n.oldMax.download!==n.newMax.download&&n.oldMax.upload===n.newMax.upload?r.yAxia[0].data=parseFloat(a.bytesConvert({data:n.newMax.download,band:1024,spliceUnit:!0}).num):n.oldMax.download===n.newMax.download&&n.oldMax.upload!==n.newMax.upload&&(r.yAxia[1].data=parseFloat(a.bytesConvert({data:n.newMax.upload,band:1024,spliceUnit:!0}).num))),o.speedChart.setOption(r),o.speedChartData.xAxis=r.xAxis[0].data,o.speedChartData.download=r.series[0].data,o.speedChartData.upload=r.series[1].data}},function(t){if(f+=1,1===f)h=(new Date).getTime();else if(m>=5){var e=(new Date).getTime();e-h<=6e4?(clearInterval(o.pool.loop.activeTorrent),o.closeAjax(o.pool.ajax.torrent),o.modal.show({type:"waring",title:"短期内多次查询活动任务失败",content:"请检查您的网络是否顺畅，或点击重载尝试重新加载一次活动任务数据！",btnText:{submit:"重载"},btnType:2,submitFunc:function(){o.loopGetTorrentData()}})):(f=0,h=(new Date).getTime())}})},o.loopGetTorrentData=function(){o.pool.ajax.torrent=c.getTorrent(o.dataStorage.session),o.pool.ajax.torrent.promise.then(function(a){o.dataStorage.torrent=e.sortBy(a.data.arguments.torrents,function(t){return-t.addedDate}),o.dataStorage.torrent=a.data.arguments.torrents,o.dataStorage.ids=[],e.each(o.dataStorage.torrent,function(t,e){o.dataStorage.ids.push(t.id)}),o.allLoaded=!0,t("#loading").addClass("loading-hide"),setTimeout(function(){t("#loading").remove()},1e3),t(".hide").removeClass("hide"),o.pool.ajax.activeTorrent=o.getRecentlyActiveTorrentData(),o.pool.loop.activeTorrent=setInterval(function(){o.getRecentlyActiveTorrentData()},o.loopFragment.torrent)},function(t){o.modal.show({type:"waring",title:"获取传输任务列表数据失败",content:"请检查您的网络是否顺畅，或点击重载重新加载任务列表一次！",btnText:{submit:"重载"},btnType:2,submitFunc:function(){o.loopGetTorrentData()}})})},o.selectTorrent=function(t){return t!==o.dataStorage.selectedIndex&&(o.dataStorage.selectedIndex=t,o.detail.compileTemplate(),void(o.detail.status===!0&&(o.detail.close(),o.detail.show())))},o.swip={left:function(){return o.modal.status!==!0&&(o.nav.status===!0&&o.nav.close(),void(o.getScreenWidth()<=1024&&(o.consolePanel.status===!1&&o.detail.status===!1?o.detail.show():o.consolePanel.status===!0&&o.detail.status===!1&&o.consolePanel.close())))},right:function(){return o.modal.status!==!0&&(o.nav.status===!0&&o.nav.close(),void(o.getScreenWidth()<=1024&&(o.consolePanel.status===!1&&o.detail.status===!0?o.detail.close():o.consolePanel.status===!1&&o.detail.status===!1&&o.consolePanel.show())))},up:function(t){return o.modal.status!==!0&&o.consolePanel.status!==!0&&o.detail.status!==!0&&void o.nav.close(t)},down:function(){return o.modal.status!==!0&&o.consolePanel.status!==!0&&o.detail.status!==!0&&void o.nav.show()}},o.bytesConvert=function(t){var e={data:t,band:1e3};return a.bytesConvert(e)},o.parseFloat2=function(t){return a.parseFloat2(t)},o.parsTorrentClassName=function(t,e){var a=o.dataStorage.torrent[e],n="";switch(t){case 0:n="paused";break;case 2:n="rechecking";break;case 4:n=a.metadataPercentComplete<1?"rechecking":"downloading";break;case 6:n="seeding";break;default:n="seeding"}return e===o.dataStorage.selectedIndex&&(n+=" selected"),n},o.parseEta=function(t){var e="";return e=t===-1?"不可用":t===-2?"无法预估":a.secondsToTime(t)},o.parseFloat2=function(t){return a.parseFloat2(t)},o.howLong=function(t){return o.parseEta(parseInt((new Date).getTime()/1e3)-t)},o.getFullDate=function(t){return a.parseFullDate(t)},o.parseText={Status:function(t){var e=o.dataStorage.torrent[t],n="";switch(e.status){case 0:n+=e.isFinished===!0?"":"已暂停",e.percentDone<1?n="已暂停":e.seedRatioLimit>e.uploadRatio?n="已暂停做种":e.isFinished===!0&&(n+="已完成做种");break;case 1:break;case 2:n+="正在验证本底数据",n+="<span>("+(e.recheckProgress<1?a.parseFloat2(100*e.recheckProgress):"100")+"% 已验证)</span>";break;case 4:n+="<span>下载自</span>",n+="<span>"+e.peersSendingToUs+"/"+e.peersConnected+"个用户</span>",n+='<span class="icon-download">',n+=o.bytesConvert(e.rateDownload)+"/s",n+="</span>",n+='<span class="icon-upload">',n+=o.bytesConvert(e.rateUpload)+"/s",n+="</span>";break;case 6:n+="<span>做种至</span>",n+="<span>"+e.peersGettingFromUs+"/"+e.peersConnected+"个用户</span>",n+='<span class="icon-upload">',n+=o.bytesConvert(e.rateUpload)+"/s",n+="</span>"}return s.trustAsHtml(n)},TransformData:function(t){var e=o.dataStorage.torrent[t],n="";switch(e.status){case 0:e.metadataPercentComplete<1?(n+="<span>磁性链接</span>",n+="<span>",n+="下载元数据（"+(e.metadataPercentComplete<1?a.parseFloat2(100*e.metadataPercentComplete):"100")+"%）",n+="</span>"):(n+="<span>",n+=o.bytesConvert(e.totalSize*(e.percentDone<1?e.percentDone:1))+"/"+o.bytesConvert(e.totalSize),n+="</span>",n+="<span>",n+="("+(e.percentDone<1?a.parseFloat2(100*e.percentDone):"100")+"%)",n+="</span>");break;case 2:n+="<span>已下载</span>",n+="<span>",n+=o.bytesConvert(e.totalSize*(e.percentDone<1?e.percentDone:1))+"/"+o.bytesConvert(e.totalSize),n+="</span>",n+="<span>",n+="("+(e.percentDone<1?a.parseFloat2(100*e.percentDone):"100")+"%)",n+="</span>",e.uploadedEver>0&&(n+="<span>",n+="已上传",n+="</span>",n+="<span>",n+=o.bytesConvert(e.uploadedEver),n+="</span>"),o.getScreenWidth()>1024&&(n+="<span>",n+="预估剩余时间："+o.parseEta(e.eta),n+="</span>");break;case 4:e.metadataPercentComplete<1?n+="<span>磁性链接</span><span> 下载元数据（"+(e.metadataPercentComplete<1?a.parseFloat2(100*e.metadataPercentComplete):"100")+"%）</span>":(n+="<span>已下载</span>",n+="<span>",n+=o.bytesConvert(e.totalSize*(e.percentDone<1?e.percentDone:1))+"/"+o.bytesConvert(e.totalSize),n+="</span>",n+="<span>",n+="("+(e.percentDone<1?a.parseFloat2(100*e.percentDone):"100")+"%)",n+="</span>",e.uploadedEver>0&&(n+="<span>",n+="已上传",n+="</span>",n+="<span>",n+=o.bytesConvert(e.uploadedEver),n+="</span>"),o.getScreenWidth()>1024&&(n+="<span>",n+="预估剩余时间："+o.parseEta(e.eta),n+="</span>"));break;case 6:n+="<span>已上传</span>",n+="<span>",n+=o.bytesConvert(e.uploadedEver)+"/"+o.bytesConvert(e.totalSize),n+="</span>",n+="<span>",n+="分享率("+e.uploadRatio.toFixed(2)+")",n+="</span>",o.getScreenWidth()>1024&&(n+="<span>",n+="预估剩余时间："+o.parseEta(e.eta),n+="</span>")}return s.trustAsHtml(n)}},o.getProgessBarWidth=function(t){var e=o.dataStorage.torrent[t],n="";switch(e.status){case 0:n=e.percentDone<1?a.floorToPercent(e.percentDone):e.seedRatioLimit<=e.uploadRatio?"100%":a.getRatioPercent(e.seedRatioLimit,e.uploadRatio);break;case 2:break;case 4:n=e.metadataPercentComplete<1?a.floorToPercent(e.metadataPercentComplete):a.floorToPercent(e.percentDone);break;case 6:n=e.seedRatioLimit<=e.uploadRatio?"100%":a.getRatioPercent(e.seedRatioLimit,e.uploadRatio);break;default:n=e.seedRatioLimit<=e.uploadRatio?"100%":a.getRatioPercent(e.seedRatioLimit,e.uploadRatio)}return n},o.initPartOfChartData=function(t){return{xAxis:[{data:function(){for(var t=[],e=(new Date).getTime(),n=7;n>0;n--)t.push({value:a.getFullTime(e-n*o.loopFragment.active),textStyle:{align:"right"}});return t.push({value:a.getFullTime(e),textStyle:{align:"right"}}),t}()}],series:[{data:function(){var e=[0,0,0,0,0,0,0],o=a.bytesConvert({data:t.rateDownload,band:1024,spliceUnit:!0});return e.push(parseFloat(o.num)),e}()},{data:function(){var e=[0,0,0,0,0,0,0],o=a.bytesConvert({data:t.rateUpload,band:1024,spliceUnit:!0});return e.push(parseFloat(o.num)),e}()}]}},o.detail={target:t("#torrent-detail"),className:"show",tabNames:["info","peers","tracker","files"],tabSelect:function(t){o.detail.selectedTabIndex=t},allPriorityStatus:-2,status:!1,chartMaxMode:!1,toggleChartMaxMode:function(){if(void 0!==o.speedChart){o.detail.chartMaxMode=o.detail.chartMaxMode!==!0;var t={yAxis:[{max:o.detail.chartMaxMode===!0?o.dataStorage.global["alt-speed-down"]:"auto"},{max:o.detail.chartMaxMode===!0?o.dataStorage.global["alt-speed-up"]:"auto"}]};o.speedChart.setOption(t)}},torrentData:!1,selectedTabIndex:0,noneBlankTemplate:!1,compileTemplate:function(){if(o.detail.noneBlankTemplate!==!0){var e="",a=typeof o.dataStorage.selectedIndex;"string"===a?e=t("#blankDetail").html():("number"===a||"object"===a&&void 0!==a.length)&&(e=t("#detail").html(),o.detail.noneBlankTemplate=!0),t("#torrent-detail-content").html(p(e)(o))}},loopGetDetail:function(){o.pool.ajax.fullDetail=c.getFullDetail(o.dataStorage.session,[o.dataStorage.torrent[o.dataStorage.selectedIndex].id]),o.pool.ajax.fullDetail.promise.then(function(t){o.dataStorage.detail=t.data.arguments.torrents[0],o.pool.loop.detail=setInterval(function(){o.pool.ajax.detail=c.getDetail(o.dataStorage.session,[o.dataStorage.torrent[o.dataStorage.selectedIndex].id]),o.pool.ajax.detail.promise.then(function(t){o.dataStorage.detail=e.merge(o.dataStorage.detail,t.data.arguments.torrents[0])},function(t){clearInterval(o.pool.loop.detail),o.closeAjax(o.pool.ajax.fullDetail),o.closeAjax(o.pool.ajax.detail),o.modal.show({type:"waring",title:"维护明细数据失败",content:"请检查您的网络是否顺畅，或点击重载尝试重新加载明细数据解决！",btnText:{submit:"重载"},btnType:2,submitFunc:function(){o.modal.close(),o.detail.loopGetDetail()}})})},o.loopFragment.detail),e.every(o.dataStorage.detail.fileStats,["priority",0])===!0?o.detail.allPriorityStatus=0:e.every(o.dataStorage.detail.fileStats,["priority",-1])===!0?o.detail.allPriorityStatus=-1:e.every(o.dataStorage.detail.fileStats,["priority",1])===!0&&(o.detail.allPriorityStatus=1)},function(t){o.modal.show({type:"waring",title:"获取明细数据失败",content:"请检查您的网络是否顺畅！",btnType:1})})},changePriority:function(t){var e={idsArr:[o.dataStorage.torrent[o.dataStorage.selectedIndex].id],priorityType:function(){var e="";switch(t.type){case-1:e="priority-low";break;case 0:e="priority-normal";break;case 1:e="priority-high"}return e}(),priorityIndexArr:function(){var e=[];if(t.index>-1)e.push(t.index);else for(var a=o.dataStorage.detail.fileStats.length,n=0;n<a;n++)e.push(n);return e}()};c.setPriority(o.dataStorage.session,e).then(function(){o.reload.detail()},function(t){o.modal.show({type:"waring",title:"设置文件优先级失败",content:"test",size:"small",btnType:1})})},show:function(){o.detail.status=o.detail.status!==!0,o.detail.status===!0?""!==o.dataStorage.selectedIndex&&(o.detail.torrentData=o.dataStorage.torrent[o.dataStorage.selectedIndex],require(["echarts"],function(a){if(o.echartsLoaded=!0,void 0===o.speedChart){var n={title:{text:"堆叠区域图",show:!1},tooltip:{show:!1,trigger:"axis"},legend:{show:!1},toolbox:{show:!1,feature:{saveAsImage:{}}},grid:{top:20,left:"-14.29%",right:0,bottom:20,containLabel:!1},xAxis:[{type:"category",splitLine:{show:!1},axisLine:{lineStyle:{color:"#FFF"}},axisTick:{show:!1},axisLabel:{textStyle:{color:"#888"}},boundaryGap:!1}],yAxis:[{type:"value",splitNumber:0,minInterval:0,silent:!0,splitLine:{show:!1},axisLine:{show:!1},axisTick:{show:!1},axisLabel:{show:!1},min:0},{type:"value",splitNumber:0,minInterval:0,silent:!0,splitLine:{show:!1},axisLine:{show:!1},axisTick:{show:!1},axisLabel:{show:!1},min:0}],series:[{name:"下载速度",type:"line",smooth:!0,showAllSymbol:!1,areaStyle:{normal:{color:new a.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"rgba(71, 121, 189, 1)"},{offset:1,color:"rgba(71, 121, 189, 0)"}],!1)}},showSymbol:!0,itemStyle:{normal:{opacity:0}},lineStyle:{normal:{color:"#4779bd"}}},{name:"上传速度",type:"line",smooth:!0,showAllSymbol:!1,areaStyle:{normal:{color:new a.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"rgba(52,203,208, 1)"},{offset:1,color:"rgba(52,203,208, 0)"}],!1)}},showSymbol:!1,itemStyle:{normal:{opacity:0}},lineStyle:{normal:{color:"#34cbd0"}}}]},r=o.initPartOfChartData(o.detail.torrentData);n=e.merge(n,r),o.$apply(function(){i(function(){void 0===o.speedChart&&(o.speedChart=a.init(document.getElementById("download-speed-chart")),o.speedChart.setOption(n),o.speedChartData.xAxis=n.xAxis[0].data,o.speedChartData.download=n.series[0].data,o.speedChartData.upload=n.series[1].data,t(window).resize(function(){o.speedChart.resize()})),console.log(o.speedChartData)})})}else{var s=o.initPartOfChartData(o.detail.torrentData);o.speedChart.setOption(s),o.speedChartData.xAxis=s.xAxis[0].data,o.speedChartData.download=s.series[0].data,o.speedChartData.upload=s.series[1].data}},function(){console.log("echarts load fail!")}),o.detail.loopGetDetail()):o.detail.close()},dbshow:function(t,e){o.getScreenWidth()>1024&&(o.nav.close(),o.detail.show())},close:function(){o.detail.status=!1,clearInterval(o.pool.loop.detail),o.closeAjax(o.pool.ajax.fullDetail),o.closeAjax(o.pool.ajax.detail)},parseErrorText:function(){var t="";switch(o.detail.torrentData.error){case 0:t="无错误";break;case 1:t="Tracker服务器告警";break;case 2:t="Tracker服务器错误";break;case 3:t="本地错误";break;default:t=o.detail.torrentData.errorString}return t}},o.setting={show:function(){o.modal.show({type:"window",btnType:2,submitFunc:function(){l.location.reload()}})}},o.closeAjax=function(t){"object"==typeof t&&"function"==typeof t.resolve&&t.resolve()},o.reload={session:function(){clearInterval(o.pool.loop.session),o.closeAjax(o.pool.ajax.session),o.closeAjax(o.pool.ajax.sessionStats),o.loopGetSession()},torrent:function(){clearInterval(o.pool.loop.activeTorrent),o.closeAjax(o.pool.ajax.torrent),o.closeAjax(o.pool.ajax.activeTorrent),o.loopGetTorrentData()},detail:function(){clearInterval(o.pool.loop.detail),o.closeAjax(o.pool.ajax.fullDetail),o.closeAjax(o.pool.ajax.detail),o.detail.loopGetDetail()}},o.isAllLoaded=function(){return o.allLoaded};var v=function(e){var a=!0;return(0===o.dataStorage.torrent.length||void 0===e||0===e.length||1===e.length&&void 0===e[0])&&(a=!1),t(window).width()<=1024&&(o.consolePanel.status=!1),a};o.addTransform=function(a){return o.isAllLoaded()!==!1&&(o.dataStorage.addTransform["download-dir"]=o.dataStorage.global["download-dir"],a.stopPropagation(),void o.modal.show({type:"add",size:"big",title:"添加任务",btnText:{submit:"添加"},tmp:o.tmpUrl.addFiles,submitFunc:function(){o.modal.close();var a=t("#addTorrentUrl")[0].value;if(""!==a&&void 0!==a&&null!==a){var n={paused:o.dataStorage.addTransform.paused!==!0,"download-dir":o.dataStorage.addTransform["download-dir"],filename:a};c.addTransform(o.dataStorage.session,n).then(function(){o.reload.torrent(),o.reload.session()},function(t){o.modal.show({type:"waring",title:"任务添加失败",content:a,size:"small",btnType:1})})}else{var r=[],s=t("#addTorrentFiles")[0].files,i=[],l=!1,d=!1;e.each(s,function(t,e){var a=new FileReader;a.onload=function(a){var n=a.target.result,p="base64,",u=n.indexOf(p);if(u>-1){var m=n.substring(u+p.length),g={paused:o.dataStorage.addTransform.paused!==!0,"download-dir":o.dataStorage.addTransform["download-dir"],metainfo:m};r[e]=c.addTransform(o.dataStorage.session,g).then(function(){r.length===s.length&&l===!1&&(setTimeout(function(){o.reload.torrent(),o.reload.session()},3e3),l=!0)},function(a){r.length===s.length&&d===!1?(d=!0,o.modal.show({type:"waring",title:"任务添加失败",content:i.join(";"),size:"small",btnType:1})):i[e]=t.name+a.data.result})}},a.readAsDataURL(t)})}}}))},o.removeFromList=function(t){return v(t)!==!1&&void o.modal.show({type:"waring",title:"确定要从传输任务列表中删除"+(t.length>1?"这些":"此")+"任务吗？",content:t.length>1?"已选中多个任务":o.dataStorage.torrent[o.dataStorage.selectedIndex].name,btnType:2,btnText:{submit:"删除"},submitFunc:function(){o.modal.close(),c.removeFromList(o.dataStorage.session,t).then(function(t){o.reload.torrent()},function(t){o.modal.show({type:"waring",title:"从下载列表中移除任务失败",content:"请检查您的网络是否顺畅！",btnType:1})})}})},o.pauseTransform=function(t){return v(t)!==!1&&void c.pauseTransform(o.dataStorage.session,t).then(function(t){o.reload.torrent()},function(t){o.modal.show({type:"waring",title:"暂停传输任务请求失败！",content:"请检查您的网络是否顺畅！",btnType:1})})},o.startTransform=function(t){return v(t)!==!1&&void c.startTransform(o.dataStorage.session,t).then(function(t){o.reload.torrent()},function(t){o.modal.show({type:"waring",title:"开始传输任务请求失败！",content:"请检查您的网络是否顺畅！",btnType:1})})},o.startTransformNow=function(t){return v(t)!==!1&&void c.startTransformNow(o.dataStorage.session,t).then(function(t){o.reload.torrent()},function(t){o.modal.show({type:"waring",title:"立即开始传输任务请求失败！",content:"请检查您的网络是否顺畅！",size:"small",btnType:1})})},o.submitSettings=function(t){c.saveSettings(o.dataStorage.session,t).then(function(t){o.modal.status=!1,o.getStatsData(),o.reload.session()},function(e){o.modal.show({type:"waring",title:"保存设置失败！",content:"请检查您的网络是否顺畅，或点击重试再尝试一次！",size:"small",btnText:{submit:"重试"},btnType:2,submitFunc:function(){o.submitSettings(t)}})})},o.consolePanel={status:!1,show:function(){o.consolePanel.status=!0},close:function(){o.consolePanel.status=!1}},o.modal={status:!1,isNeedTitle:!1,type:"add",size:"small",title:"添加传输任务失败",content:"请检查你的网络，或者尝试重新添加一次！",btnType:2,tempatesUrl:"template/modals.html",tmp:"",btnText:{submit:"确定",cancel:"关闭"},submitFunc:function(){o.modal.close()},show:function(a){if(void 0!==a&&null!==a.$event&&void 0!==a.$event&&a.$event.stopPropagation(),o.modal.status===!0)return!1;o.modal.size=void 0===a.size?"small":a.size,a.btnText?(a.btnText.submit=""!==a.btnText.submit&&a.btnText.submit?a.btnText.submit:"确定",a.btnText.cancel=""!==a.btnText.cancel&&a.btnText.cancel?a.btnText.cancel:"关闭"):a.btnText={submit:"确定",cancel:"关闭"},o.modal.tmp=void 0!==a.tmp?a.tmp:o.tmpUrl.modal;var n=t("#"+o.modal.tmp).html();t("#modal").html(p(n)(o));var r="alpha";void 0!==a&&e.each(a,function(t,e){"show"!==e&&"close"!==e&&"status"!==e&&(o.modal[e]=t)}),o.modal.status=o.modal.status!==!0,i(function(){t("#modal-bg").addClass(r),t("#modal").addClass(r)},100)},close:function(){var e="alpha";t("#modal-bg").removeClass(e),t("#modal").removeClass(e),i(function(){o.modal.status=!1,o.modal.tmp=""},233)},selectTagContent:function(t){return o.tag.index===t}},o.tag={name:["种子","速度","用户","网络"],index:0,swipLeft:function(){o.tag.index<3&&(o.tag.index+=1)},swipRight:function(){o.tag.index>0&&(o.tag.index-=1)},toggle:function(t){o.tag.index=t}},o.nav={status:!1,menudata:{name:["设置","计划任务运行","收缩视图","查看传输明细","统计","关于"],className:["icon-settings","icon-scheduled","icon-listview","icon-info-black","icon-data_usage","icon-goat"]},toggle:function(){return o.allLoaded!==!1&&void(o.nav.status=o.nav.status!==!0)},show:function(){o.nav.status=!0},close:function(t,a){switch(t&&t.stopPropagation(),o.nav.status=!1,a){case 0:o.dataStorage.settings=angular.copy(o.dataStorage.global),c.portTest(o.dataStorage.session).then(function(t){o.dataStorage["port-test"]=t.data.arguments["port-is-open"]},function(t){o.modal.show({type:"waring",title:"端口是否开启检测失败",content:"请检查您的网络是否顺畅！",btnType:1})}),o.modal.show({type:"setting",size:"size-window",tmp:o.tmpUrl.settings,btnType:2,btnText:{submit:"保存"},submitFunc:function(){var t={};e.each(o.dataStorage.settings,function(e,a){var n=typeof o.dataStorage.global[a];e="number"===n?parseFloat(e):e,e!==o.dataStorage.global[a]&&"units"!==a&&(t[a]=e)}),o.submitSettings(t)}});break;case 1:var n={"alt-speed-enabled":o.dataStorage.global["alt-speed-enabled"]!==!0};c.saveSettings(o.dataStorage.session,n).then(function(t){o.reload.session()},function(t){o.modal.show({type:"waring",title:(n["alt-speed-enabled"]===!0?"打开":"关闭")+"计划任务失败！",content:"请检查您的网络是否顺畅，或点击确定再此尝试保存！",btnType:1})});break;case 3:o.detail.show();break;case 4:o.modal.show({type:"statics",size:"big",tmp:o.tmpUrl.statics,btnType:1});break;case 5:o.modal.show({type:"about",size:"big",tmp:o.tmpUrl.about,btnType:1})}},parseMenuVisible:function(t){return t<3}},o.getTotalSpeed=function(){var t={download:0,upload:0};e.each(o.dataStorage.torrent,function(e,a){t.download+=void 0===e.rateDownload||null===e.rateDownload?0:e.rateDownload,t.upload+=void 0===e.rateUpload||null===e.rateUpload?0:e.rateUpload}),o.dataStorage.totalSpeed.download=t.download,o.dataStorage.totalSpeed.upload=t.upload},o.getScreenWidth=function(){return t(window).width()},o.stopAllAjax=function(){e.each(o.pool.loop,function(t,e){clearInterval(o.pool.loop[e])}),e.each(o.pool.ajax,function(t,e){o.closeAjax(o.pool.ajax[e])})},o.init=function(){var t=o.$watch("detailTemplateLoaded",function(e,a){e===!0&&a===!1&&(o.detail.compileTemplate(),t())},!0);if(o.localMode=!1,o.localMode===!0){var e=r.defer();require(["localData"],function(t){e.resolve(t)}),e.promise.then(function(t){o.dataStorage={global:t.global,torrent:t.torrent,selectedIndex:t.selectedIndex,stats:t.stats,ids:t.ids,detail:t.detail},o.getTotalSpeed()},function(t){})}o.pool.loop.session=setInterval(function(){o.getSession()},3e3),o.$on("getSessionDone",function(t){clearInterval(o.pool.loop.session),o.getStatsData("init"),o.loopGetSession()}),o.$on("getStatsDone",function(){o.loopGetTorrentData()}),o.allLoaded=!1,o.echartsLoaded=!1,o.speedChart=void 0,document.addEventListener("touchstart",function(t){t.cancelable&&(t.defaultPrevented||t.preventDefault())},!1)},o.init()}]),r.directive("includeReplace",function(){return{require:"ngInclude",restrict:"A",link:function(t,e,a){e.replaceWith(e.children())}}}),r});
//# sourceMappingURL=maps/initConfig.min.js.map
