define(["jquery","lodash","transmission","angularAMD","mnTouch"],function(e,t,a,o){"use strict";var n=angular.module("transmission",["mn"]),s=o.bootstrap(n);return s.factory("ajaxService",["$http","$q",function(e,a){function o(t){var o=a.defer(),n=e({method:"POST",url:s+(void 0!==t.url?t.url:""),headers:void 0!==t.sessionId?{"X-Transmission-Session-Id":t.sessionId}:{},data:function(){var e={};switch(t.param.method){case"torrent-get":e=t.param;break;case"torrent-remove":e=t.param;break;default:e=t.param}return e}()});return a.when(n,function(e,t,a,n){o.resolve(e,t,a,n)},function(e,a){0!==a&&o.reject({errService:t.errService?t.errService:"Service Error",err:t.err,response:e,status:a})}),t.cancel===!0?o:o.promise}var n={},s="/transmission/rpc";n.getSession=function(e){return o({sessionId:e,param:{method:"session-get"},url:"?type=getSession",cancel:!0})},n.getSessionStats=function(e){return o({sessionId:e,param:{method:"session-stats"},url:"?type=getSessionStats"})};var r={all:["id"],torrentSame:["error","errorString","eta","isFinished","isStalled","leftUntilDone","metadataPercentComplete","peersConnected","peersGettingFromUs","peersSendingToUs","percentDone","queuePosition","rateDownload","rateUpload","recheckProgress","seedRatioMode","seedRatioLimit","sizeWhenDone","status","trackers","downloadDir","uploadedEver","uploadRatio","webseedsSendingToUs"],detailSame:["activityDate","corruptEver","desiredAvailable","downloadedEver","fileStats","haveUnchecked","haveValid","peers","startDate","trackerStats"]};return n.getTorrent=function(e){return o({sessionId:e,param:{method:"torrent-get",arguments:{fields:t.concat(r.all,r.torrentSame,["addedDate","name","totalSize"])}},url:"?type=getTorrent",cancel:!0})},n.getActiveTorrent=function(e){return o({sessionId:e,param:{method:"torrent-get",arguments:{fields:t.concat(r.all,r.torrentSame),ids:"recently-active"}},url:"?type=getActiveTorrent",cancel:!0})},n.getFullDetail=function(e,a){return o({sessionId:e,param:{method:"torrent-get",arguments:{fields:t.concat(r.all,r.detailSame,["comment","creator","dateCreated","files","hashString","isPrivate","pieceCount","pieceSize"]),ids:a}},url:"?type=getFullDetail",cancel:!0})},n.getDetail=function(e,a){return o({sessionId:e,param:{method:"torrent-get",arguments:{fields:t.concat(r.all,r.detailSame),ids:a}},url:"?type=getDetail",cancel:!0})},n.addTransform=function(e,t){return o({sessionId:e,param:{method:"torrent-add",arguments:t},url:"?type=torrent-add"})},n.startTorrent=function(e){return o({sessionId:e,param:{method:"torrent-start"},url:"?type=startTorrent"})},n.stopTorrent=function(e){return o({sessionId:e,param:{method:"torrent-stop"},url:"?type=stopTorrent"})},n.removeFromList=function(e,t){return o({sessionId:e,param:{method:"torrent-remove",arguments:{ids:t}},url:"?type=removeFromList"})},n.removeAllData=function(e,t){return o({sessionId:e,param:{method:"torrent-remove",arguments:{"delete-local-data":!0,ids:t}},url:"?type=removeAllData"})},n.pauseTransform=function(e,t){return o({sessionId:e,param:{method:"torrent-stop",arguments:{ids:t}},url:"?type=torrent-stop"})},n.startTransform=function(e,t){return o({sessionId:e,param:{method:"torrent-start",arguments:{ids:t}},url:"?type=torrent-start"})},n.startTransformNow=function(e,t){return o({sessionId:e,param:{method:"torrent-start-now",arguments:{ids:t}},url:"?type=torrent-start-now"})},n.portTest=function(e){return o({sessionId:e,param:{method:"port-test"},url:"?type=port-test"})},n.saveSettings=function(e,t){return o({sessionId:e,param:{method:"session-set",arguments:t},url:"?type=saveSettings"})},n}]),s.controller("mainController",["$scope","$http","$q","$sce","$timeout","$window","$document","$compile","ajaxService",function(o,n,s,r,l,i,d,c,u){var p="template/";o.tmpUrl={detail:p+"detail.html",blankDetail:p+"blankdetail.html",tips:"modal_t",settings:"settings",modal:"modal_t",about:"about",statics:"statics",addFiles:"addFiles"},o.pool={loop:{torrent:0,activeTorrent:0,session:0,sessionStats:0,detail:0},ajax:{torrent:{},activeTorrent:{},detail:{},fullDetail:{},sessionStats:{},session:{},remove:{},add:{},pause:{}}},o.dataStorage={session:"",globalOrignal:{},global:{"alt-speed-down":0,"alt-speed-up":0,"alt-speed-time-begin":0,"alt-speed-time-end":0,"alt-speed-time-day":127},torrent:[],selectedIndex:"",stats:{},ids:[],detail:{},"port-test":!1,searchText:{name:""},totalSpeed:{download:0,upload:0},"speed-limit-times":function(){for(var e=[],t=0,a=function(e){var t="",a=0,o=0;return e<60?t="00:"+(e<10?"0"+e:e):(a=parseInt(e/60),o=e-60*a,t=(a<10?"0"+a:a)+":"+(0===o?"00":o)),t},o=0;o<96;o++)e.push({key:a(t),value:t}),t+=15;return e}(),"speed-limit-day":[{key:"每天",value:127},{key:"工作日",value:62},{key:"周末",value:65},{key:"星期天",value:1},{key:"星期一",value:2},{key:"星期二",value:4},{key:"星期三",value:8},{key:"星期四",value:16},{key:"星期五",value:32},{key:"星期六",value:64}],encryption:[{key:"允许加密",value:"tolerated"},{key:"喜欢加密",value:"preferred"},{key:"需要加密",value:"required"}],addTransform:{metainfo:[],filename:"","download-dir":"123123",paused:!0}},o.loopFragment={torrent:5e3,active:5e3,detail:5e3,session:3e4};var m=0,g="";o.getSession=function(e){o.pool.ajax.session=u.getSession(e),o.pool.ajax.session.promise.then(function(e){m=0,o.dataStorage.global=e.data.arguments,o.dataStorage.globalOrignal=t.clone(e.data.arguments)},function(e){var t=!0,a=e.response.data;if(null===a&&(t=!1),t===!0){var n="X-Transmission-Session-Id: ",s=a.indexOf(n),r=a.indexOf("</code>");s!==-1&&r!==-1?(o.dataStorage.session=a.substring(s+(n.length-1),r),o.$emit("getSessionDone")):t=!1}if(t===!1)if(m+=1,1===m)g=(new Date).getTime();else if(m>=5){var l=(new Date).getTime();l-g<=18e4?(o.stopAllAjax(),o.modal.show({type:"waring",title:"一分钟内请求Session失败次数过多",content:"请检查您的网络是否顺畅，或点击确定通过刷新尝试解决！",btnType:2,submitFunc:function(){i.location.reload()}})):(m=0,g=(new Date).getTime())}})},o.loopGetSession=function(){o.getSession(o.dataStorage.session),o.pool.loop.session=setInterval(function(){o.getSession(o.dataStorage.session)},o.loopFragment.session)},o.getStatsData=function(e){o.pool.ajax.sessionStats=u.getSessionStats(o.dataStorage.session).then(function(t){o.dataStorage.stats=t.data.arguments,"init"===e&&(o.dataStorage.totalSpeed.download=o.dataStorage.stats.downloadSpeed,o.dataStorage.totalSpeed.upload=o.dataStorage.stats.uploadSpeed,o.$emit("getStatsDone"))},function(e){o.modal.show({type:"waring",title:"查询统计数据失败",content:"请检查您的网络是否顺畅，或点击确定重新加载一次！",btnType:2,submitFunc:function(){o.getStatsData()}})})};var f=0,v=0;o.getRecentlyActiveTorrentData=function(){o.pool.ajax.activeTorrent=u.getActiveTorrent(o.dataStorage.session),o.pool.ajax.activeTorrent.promise.then(function(e){f=0,t.each(e.data.arguments.torrents,function(e,a){var n=t.findIndex(o.dataStorage.torrent,function(t){return t.id===e.id});n>-1&&t.merge(o.dataStorage.torrent[n],e)}),o.getTotalSpeed()},function(e){if(f+=1,1===f)v=(new Date).getTime();else if(m>=5){var t=(new Date).getTime();t-v<=6e4?(clearInterval(o.pool.loop.activeTorrent),o.closeAjax(o.pool.ajax.torrent),o.modal.show({type:"waring",title:"短期内多次查询活动任务失败",content:"请检查您的网络是否顺畅，或点击确定通过刷新尝试解决！",btnType:2,submitFunc:function(){o.loopGetTorrentData()}})):(f=0,v=(new Date).getTime())}})},o.sortTorrentData=function(){return o.dataStorage.torrent=t.sortBy(o.dataStorage.torrent,function(e){return-e.addedDate}),o.getTotalSpeed(),o.dataStorage.torrent},o.loopGetTorrentData=function(){o.pool.ajax.torrent=u.getTorrent(o.dataStorage.session),o.pool.ajax.torrent.promise.then(function(a){o.dataStorage.torrent=t.sortBy(a.data.arguments.torrents,function(e){return-e.addedDate}),o.dataStorage.ids=[],t.each(o.dataStorage.torrent,function(e,t){o.dataStorage.ids.push(e.id)}),o.allLoaded=!0,e("#loading").addClass("loading-hide"),setTimeout(function(){e("#loading").remove()},1e3),e(".hide").removeClass("hide"),o.pool.ajax.activeTorrent=o.getRecentlyActiveTorrentData(),o.pool.loop.activeTorrent=setInterval(function(){o.getRecentlyActiveTorrentData()},o.loopFragment.torrent)},function(e){o.modal.show({type:"waring",title:"获取传输任务列表数据失败",content:"请检查您的网络是否顺畅，或点击确定重新加载一次！",btnType:2,submitFunc:function(){o.loopGetTorrentData()}})})},o.selectTorrent=function(e){return e!==o.dataStorage.selectedIndex&&(o.dataStorage.selectedIndex=e,void(o.detail.status===!0&&(o.detail.close(),o.detail.show())))},o.swip={left:function(){return o.modal.status!==!0&&(o.nav.status===!0&&o.nav.close(),void(o.getScreenWidth()<=1024&&(o.consolePanel.status===!1&&o.detail.status===!1?o.detail.show():o.consolePanel.status===!0&&o.detail.status===!1&&o.consolePanel.close())))},right:function(){return o.modal.status!==!0&&(o.nav.status===!0&&o.nav.close(),void(o.getScreenWidth()<=1024&&(o.consolePanel.status===!1&&o.detail.status===!0?o.detail.close():o.consolePanel.status===!1&&o.detail.status===!1&&o.consolePanel.show())))},up:function(e){return o.modal.status!==!0&&o.consolePanel.status!==!0&&o.detail.status!==!0&&void o.nav.close(e)},down:function(){return o.modal.status!==!0&&o.consolePanel.status!==!0&&o.detail.status!==!0&&void o.nav.show()}},o.bytesConvert=function(e){var t={data:e,band:1e3};return a.bytesConvert(t)},o.parseFloat2=function(e){return a.parseFloat2(e)},o.parsTorrentClassName=function(e,t){var a="";switch(e){case 0:a="paused";break;case 2:a="rechecking";break;case 4:a="downloading";break;case 6:a="seeding";break;default:a="seeding"}return t===o.dataStorage.selectedIndex&&(a+=" selected"),a},o.parseEta=function(e){var t="";return t=e===-1?"不可用":e===-2?"无法预估":a.secondsToTime(e)},o.parseFloat2=function(e){return a.parseFloat2(e)},o.getStatusText=function(e){var t="";switch(e.status){case 0:t=e.metaComplete<1?"磁性链接下载元数据中":"已暂停";break;case 4:t="下载中";break;case 6:t="做种中"}return t},o.howLong=function(e){return o.parseEta(parseInt((new Date).getTime()/1e3)-e)},o.getFullDate=function(e){return a.parseFullDate(e)},o.parseText={Status:function(e){var t=o.dataStorage.torrent[e],n="";switch(t.status){case 0:n+="已暂停";break;case 1:break;case 2:n+="正在验证本底数据",n+="<span>("+(t.recheckProgress<1?a.parseFloat2(100*t.recheckProgress):"100")+"% 已验证)</span>";break;case 4:n+="下载自",n+="<span>"+t.peersSendingToUs+"/"+t.peersConnected+"个用户</span>",n+='<span class="icon-download">',n+=o.bytesConvert(t.rateDownload)+"/s",n+="</span>",n+='<span class="icon-upload">',n+=o.bytesConvert(t.rateUpload)+"/s",n+="</span>";break;case 6:n+="分享至",n+="<span>"+t.peersGettingFromUs+"/"+t.peersConnected+"个用户</span>",n+='<span class="icon-upload">',n+=o.bytesConvert(t.rateUpload)+"/s",n+="</span>"}return r.trustAsHtml(n)},TransformData:function(e){var t=o.dataStorage.torrent[e],n="";switch(t.status){case 0:t.metadataPercentComplete<1?(n+="磁性链接",n+="<span>",n+="下载元数据（"+(t.metadataPercentComplete<1?a.parseFloat2(100*t.metadataPercentComplete):"100")+"%）",n+="</span>"):(n+="<span>",n+=o.bytesConvert(t.totalSize*(t.percentDone<1?t.percentDone:1))+"/"+o.bytesConvert(t.totalSize),n+="</span>",n+="<span>",n+="("+(t.percentDone<1?a.parseFloat2(100*t.percentDone):"100")+"%)",n+="</span>");break;case 2:n+="已下载",n+="<span>",n+=o.bytesConvert(t.totalSize*(t.percentDone<1?t.percentDone:1))+"/"+o.bytesConvert(t.totalSize),n+="</span>",n+="<span>",n+="("+(t.percentDone<1?a.parseFloat2(100*t.percentDone):"100")+"%)",n+="</span>",t.uploadedEver>0&&(n+="<span>",n+="已上传",n+="</span>",n+="<span>",n+=o.bytesConvert(t.uploadedEver),n+="</span>"),o.getScreenWidth()>1024&&(n+="<span>",n+="预估剩余时间："+o.parseEta(t.eta),n+="</span>");break;case 4:t.metadataPercentComplete<1?n+="磁性链接<span> 下载元数据（"+(t.metadataPercentComplete<1?a.parseFloat2(100*t.metadataPercentComplete):"100")+"）</span>":(n+="已下载",n+="<span>",n+=o.bytesConvert(t.totalSize*(t.percentDone<1?t.percentDone:1))+"/"+o.bytesConvert(t.totalSize),n+="</span>",n+="<span>",n+="("+(t.percentDone<1?a.parseFloat2(100*t.percentDone):"100")+"%)",n+="</span>",t.uploadedEver>0&&(n+="<span>",n+="已上传",n+="</span>",n+="<span>",n+=o.bytesConvert(t.uploadedEver),n+="</span>"),o.getScreenWidth()>1024&&(n+="<span>",n+="预估剩余时间："+o.parseEta(t.eta),n+="</span>"));break;case 6:n+="已上传",n+="<span>",n+=o.bytesConvert(t.uploadedEver)+"/"+o.bytesConvert(t.totalSize),n+="</span>",n+="<span>",n+="分享率("+a.parseFloat2(t.uploadRatio)+"%)",n+="</span>",o.getScreenWidth()>1024&&(n+="<span>",n+="预估剩余时间："+o.parseEta(t.eta),n+="</span>")}return r.trustAsHtml(n)}},o.detail={target:e("#torrent-detail"),className:"show",tabNames:["info","peers","tracker","files"],tabSelect:function(e){o.detail.selectedTabIndex=e},status:!1,torrentData:!1,selectedTabIndex:0,loopGetDetail:function(){o.pool.ajax.fullDetail=u.getFullDetail(o.dataStorage.session,[o.dataStorage.torrent[o.dataStorage.selectedIndex].id]),o.pool.ajax.fullDetail.promise.then(function(e){o.dataStorage.detail=e.data.arguments.torrents[0],o.pool.loop.detail=setInterval(function(){o.pool.ajax.detail=u.getDetail(o.dataStorage.session,[o.dataStorage.torrent[o.dataStorage.selectedIndex].id]),o.pool.ajax.detail.promise.then(function(e){o.dataStorage.detail=t.merge(o.dataStorage.detail,e.data.arguments.torrents[0])},function(e){clearInterval(o.pool.loop.detail),o.closeAjax(o.pool.ajax.fullDetail),o.closeAjax(o.pool.ajax.detail),o.modal.show({type:"waring",title:"维护明细数据失败",content:"请检查您的网络是否顺畅，或点击确定通过刷新尝试解决！",btnType:2,submitFunc:function(){o.detail.loopGetDetail()}})})},o.loopFragment.detail)},function(e){o.modal.show({type:"waring",title:"获取明细数据失败",content:"请检查您的网络是否顺畅！",btnType:1})})},show:function(){o.detail.status=o.detail.status!==!0,o.detail.status===!0?""!==o.dataStorage.selectedIndex&&(o.detail.torrentData=o.dataStorage.torrent[o.dataStorage.selectedIndex],o.detail.loopGetDetail()):o.detail.close()},dbshow:function(e,t){o.getScreenWidth()>1024&&(o.nav.close(),o.detail.show())},close:function(){o.detail.status=!1,clearInterval(o.pool.loop.detail),o.closeAjax(o.pool.ajax.fullDetail),o.closeAjax(o.pool.ajax.detail)},parseErrorText:function(){var e="";switch(o.detail.torrentData.error){case 0:e="无错误";break;case 1:e="Tracker服务器告警";break;case 2:e="Tracker服务器错误";break;case 3:e="本地错误";break;default:e=o.detail.torrentData.errorString}return e}},o.setting={show:function(){o.modal.show({type:"window",btnType:2,submitFunc:function(){i.location.reload()}})}},o.closeAjax=function(e){"object"==typeof e&&"function"==typeof e.resolve&&e.resolve()},o.reload={session:function(){clearInterval(o.pool.loop.session),o.closeAjax(o.pool.ajax.session),o.closeAjax(o.pool.ajax.sessionStats),o.loopGetSession()},torrent:function(){clearInterval(o.pool.loop.activeTorrent),o.closeAjax(o.pool.ajax.torrent),o.closeAjax(o.pool.ajax.activeTorrent),o.loopGetTorrentData()},detail:function(){clearInterval(o.pool.loop.detail),o.closeAjax(o.pool.ajax.fullDetail),o.closeAjax(o.pool.ajax.detail),o.detail.loopGetDetail()}};var S=function(t){var a=!0;return(0===o.dataStorage.torrent.length||void 0===t||0===t.length||1===t.length&&void 0===t[0])&&(a=!1),e(window).width()<=1024&&(o.consolePanel.status=!1),a};o.addTransform=function(e){o.dataStorage.addTransform.paused=!0,o.dataStorage.addTransform["download-dir"]=o.dataStorage.global["download-dir"],e.stopPropagation(),o.modal.show({type:"add",size:"big",title:"添加任务",tmp:o.tmpUrl.addFiles,submitFunc:function(){o.modal.close();var e=angular.element("#addTorrentUrl")[0].value;if(""!==e&&void 0!==e&&null!==e){var a={paused:o.dataStorage.addTransform.paused,"download-dir":o.dataStorage.addTransform["download-dir"],filename:e};u.addTransform(o.dataStorage.session,a).then(function(){o.reload.torrent(),o.reload.session()},function(t){o.modal.show({type:"waring",title:"任务添加失败",content:e,size:"small",btnType:1})})}else{var n=[],s=angular.element("#addTorrentFiles")[0].files,r=[],l=!1,i=!1;t.each(s,function(e,t){var a=new FileReader;a.onload=function(a){var d=a.target.result,c="base64,",p=d.indexOf(c);if(p>-1){var m=d.substring(p+c.length),g={paused:o.dataStorage.addTransform.paused,"download-dir":o.dataStorage.addTransform["download-dir"],metainfo:m};n[t]=u.addTransform(o.dataStorage.session,g).then(function(){n.length===s.length&&l===!1&&(setTimeout(function(){o.reload.torrent(),o.reload.session()},3e3),l=!0)},function(a){n.length===s.length&&i===!1?(i=!0,o.modal.show({type:"waring",title:"任务添加失败",content:r.join(";"),size:"small",btnType:1})):r[t]=e.name+a.data.result})}},a.readAsDataURL(e)})}}})},o.removeFromList=function(e){return S(e)!==!1&&void o.modal.show({type:"waring",title:"确定要从传输任务列表中删除"+(e.length>1?"这些":"此")+"任务吗？",content:e.length>1?"已选中多个任务":o.dataStorage.torrent[o.dataStorage.selectedIndex].name,btnType:2,submitFunc:function(){o.modal.close(),u.removeFromList(o.dataStorage.session,e).then(function(e){o.reload.torrent()},function(e){o.modal.show({type:"waring",title:"从下载列表中移除任务失败",content:"请检查您的网络是否顺畅！",btnType:1})})}})},o.pauseTransform=function(e){return S(e)!==!1&&void u.pauseTransform(o.dataStorage.session,e).then(function(e){o.reload.torrent()},function(e){o.modal.show({type:"waring",title:"暂停传输任务请求失败！",content:"请检查您的网络是否顺畅！",btnType:1})})},o.startTransform=function(e){return S(e)!==!1&&void u.startTransform(o.dataStorage.session,e).then(function(e){o.reload.torrent()},function(e){o.modal.show({type:"waring",title:"开始传输任务请求失败！",content:"请检查您的网络是否顺畅！",btnType:1})})},o.startTransformNow=function(e){return S(e)!==!1&&void u.startTransformNow(o.dataStorage.session,e).then(function(e){o.reload.torrent()},function(e){o.modal.show({type:"waring",title:"立即开始传输任务请求失败！",content:"请检查您的网络是否顺畅！",size:"small",btnType:1})})},o.submitSettings=function(e){u.saveSettings(o.dataStorage.session,e).then(function(e){o.dataStorage.globalOrignal={},o.modal.status=!1,o.getStatsData(),o.reload.session()},function(t){o.modal.show({type:"waring",title:"保存设置失败！",content:"请检查您的网络是否顺畅，或点击确定再此尝试保存！",size:"small",btnType:2,submitFunc:function(){o.submitSettings(e)}})})},o.consolePanel={status:!1,show:function(){o.consolePanel.status=!0},close:function(){o.consolePanel.status=!1}},o.modal={status:!1,isNeedTitle:!1,type:"add",size:"small",title:"添加传输任务失败",content:"请检查你的网络，或者尝试重新添加一次！",btnType:2,tempatesUrl:"template/modals.html",tmp:"",btnText:{submit:"确定",cancel:"关闭"},submitFunc:function(){o.modal.close()},show:function(a){if(void 0!==a&&null!==a.$event&&void 0!==a.$event&&a.$event.stopPropagation(),o.modal.status===!0)return!1;"window"===a.type?o.modal.size="window":void 0===a.size&&(o.modal.size="small"),void 0!==a.tmp?o.modal.tmp=a.tmp:o.modal.tmp=o.tmpUrl.modal;var n=e("#"+o.modal.tmp).html();e("#modal").html(c(n)(o));var s="alpha";void 0!==a&&t.each(a,function(e,t){"show"!==t&&"close"!==t&&"status"!==t&&(o.modal[t]=e)}),o.modal.status=o.modal.status!==!0,l(function(){e("#modal-bg").addClass(s),e("#modal").addClass(s)},100)},close:function(){var t="alpha";e("#modal-bg").removeClass(t),e("#modal").removeClass(t),o.modal.tmp===o.tmpUrl.settings&&o.reload.session(),setTimeout(function(){o.modal.status=!1,o.modal.tmp=""},240)},selectTagContent:function(e){return o.tag.index===e}},o.tag={name:["种子","速度","用户","网络"],index:0,swipLeft:function(){o.tag.index<3&&o.getScreenWidth()<=1024&&(o.tag.index+=1)},swipRight:function(){o.tag.index>0&&o.getScreenWidth()<=1024&&(o.tag.index-=1)},toggle:function(e){o.tag.index=e}},o.nav={status:!1,menudata:{name:["设置","计划任务运行","收缩视图","查看传输明细","统计","关于"],className:["icon-settings","icon-scheduled","icon-listview","icon-info-black","icon-data_usage","icon-goat"]},toggle:function(){return o.allLoaded!==!1&&void(o.nav.status=o.nav.status!==!0)},show:function(){o.nav.status=!0},close:function(e,a){switch(e&&e.stopPropagation(),o.nav.status=!1,a){case 0:clearInterval(o.pool.loop.session),u.portTest(o.dataStorage.session).then(function(e){o.dataStorage["port-test"]=e.data.arguments["port-is-open"]},function(e){o.modal.show({type:"waring",title:"端口是否开启检测失败",content:"请检查您的网络是否顺畅！",btnType:1})}),o.modal.show({type:"window",tmp:o.tmpUrl.settings,btnType:2,submitFunc:function(){var e={};t.each(o.dataStorage.global,function(t,a){t!==o.dataStorage.globalOrignal[a]&&(e[a]=t)}),o.submitSettings(e)}});break;case 1:var n={"alt-speed-enabled":o.dataStorage.global["alt-speed-enabled"]!==!0};u.saveSettings(o.dataStorage.session,n).then(function(e){o.reload.session()},function(e){o.modal.show({type:"waring",title:(n["alt-speed-enabled"]===!0?"打开":"关闭")+"计划任务失败！",content:"请检查您的网络是否顺畅，或点击确定再此尝试保存！",btnType:1})});break;case 3:o.detail.show();break;case 4:o.modal.show({type:"statics",size:"big",tmp:o.tmpUrl.statics,btnType:1});break;case 5:o.modal.show({type:"tip",size:"big",tmp:o.tmpUrl.about,btnType:1})}},parseMenuVisible:function(e){return e<3}},o.getTotalSpeed=function(){var e={download:0,upload:0};t.each(o.dataStorage.torrent,function(t,a){e.download+=void 0===t.rateDownload||null===t.rateDownload?0:t.rateDownload,e.upload+=void 0===t.rateUpload||null===t.rateUpload?0:t.rateUpload}),o.dataStorage.totalSpeed.download=e.download,o.dataStorage.totalSpeed.upload=e.upload},o.getScreenWidth=function(){return e(window).width()},o.stopAllAjax=function(){t.each(o.pool.loop,function(e,t){clearInterval(o.pool.loop[t])}),t.each(o.pool.ajax,function(e,t){o.closeAjax(o.pool.ajax[t])})},o.init=function(){if(o.localMode=!1,o.localMode===!0){var e=s.defer();require(["localData"],function(t){e.resolve(t)}),e.promise.then(function(e){o.dataStorage={global:e.global,torrent:e.torrent,selectedIndex:e.selectedIndex,stats:e.stats,ids:e.ids,detail:e.detail},o.getTotalSpeed()},function(e){})}o.pool.loop.session=setInterval(function(){o.getSession()},3e3),o.$on("getSessionDone",function(e){clearInterval(o.pool.loop.session),o.getStatsData("init"),o.loopGetSession()}),o.$on("getStatsDone",function(){o.loopGetTorrentData()}),o.allLoaded=!1,document.addEventListener("touchstart",function(e){e.cancelable&&(e.defaultPrevented||e.preventDefault())},!1)},o.init()}]),s.directive("includeReplace",function(){return{require:"ngInclude",restrict:"A",link:function(e,t,a){t.replaceWith(t.children())}}}),s});
//# sourceMappingURL=maps/initConfig.min.js.map
