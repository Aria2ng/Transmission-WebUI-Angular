define(["jquery","lodash","transmission","angularAMD","angular-touch"],function(e,t,a,o){"use strict";var n=angular.module("transmission",["ngTouch"]),r=o.bootstrap(n);return r.config(["$touchProvider",function(e){e.ngClickOverrideEnabled([!0])}]),r.factory("ajaxService",["$http","$q",function(e,a){function o(t){var o=a.defer(),n=e({method:"POST",url:r+(void 0!==t.url?t.url:""),headers:void 0!==t.sessionId?{"X-Transmission-Session-Id":t.sessionId}:{},data:function(){var e={};switch(t.param.method){case"torrent-get":e=t.param;break;case"torrent-remove":e=t.param;break;default:e=t.param}return e}()});return a.when(n,function(e,t,a,n){o.resolve(e,t,a,n)},function(e,a){0!==a&&o.reject({errService:t.errService?t.errService:"Service Error",err:t.err,response:e,status:a})}),t.cancel===!0?o:o.promise}var n={},r="/transmission/rpc";n.getSession=function(e){return o({sessionId:e,param:{method:"session-get"},url:"?type=getSession"})},n.getSessionStats=function(e){return o({sessionId:e,param:{method:"session-stats"},url:"?type=getSessionStats"})};var s={all:["id"],torrentSame:["error","errorString","eta","isFinished","isStalled","leftUntilDone","metadataPercentComplete","peersConnected","peersGettingFromUs","peersSendingToUs","percentDone","queuePosition","rateDownload","rateUpload","recheckProgress","seedRatioMode","seedRatioLimit","sizeWhenDone","status","trackers","downloadDir","uploadedEver","uploadRatio","webseedsSendingToUs"],detailSame:["activityDate","corruptEver","desiredAvailable","downloadedEver","fileStats","haveUnchecked","haveValid","peers","startDate","trackerStats"]};return n.getTorrent=function(e){return o({sessionId:e,param:{method:"torrent-get",arguments:{fields:t.concat(s.all,s.torrentSame,["addedDate","name","totalSize"])}},url:"?type=getTorrent",cancel:!0})},n.getActiveTorrent=function(e){return o({sessionId:e,param:{method:"torrent-get",arguments:{fields:t.concat(s.all,s.torrentSame),ids:"recently-active"}},url:"?type=getActiveTorrent",cancel:!0})},n.getFullDetail=function(e,a){return o({sessionId:e,param:{method:"torrent-get",arguments:{fields:t.concat(s.all,s.detailSame,["comment","creator","dateCreated","files","hashString","isPrivate","pieceCount","pieceSize"]),ids:a}},url:"?type=getFullDetail",cancel:!0})},n.getDetail=function(e,a){return o({sessionId:e,param:{method:"torrent-get",arguments:{fields:t.concat(s.all,s.detailSame),ids:a}},url:"?type=getDetail",cancel:!0})},n.startTorrent=function(e){return o({sessionId:e,param:{method:"torrent-start"},url:"?type=startTorrent"})},n.stopTorrent=function(e){return o({sessionId:e,param:{method:"torrent-stop"},url:"?type=stopTorrent"})},n.removeFromList=function(e,t){return o({sessionId:e,param:{method:"torrent-remove",arguments:{ids:t}},url:"?type=removeFromList"})},n.removeAllData=function(e,t){return o({sessionId:e,param:{method:"torrent-remove",arguments:{"delete-local-data":!0,ids:t}},url:"?type=removeAllData"})},n.pauseTransform=function(e,t){return o({sessionId:e,param:{method:"torrent-stop",arguments:{ids:t}},url:"?type=torrent-stop"})},n.startTransform=function(e,t){return o({sessionId:e,param:{method:"torrent-start",arguments:{ids:t}},url:"?type=torrent-start"})},n.startTransformNow=function(e,t){return o({sessionId:e,param:{method:"torrent-start-now",arguments:{ids:t}},url:"?type=torrent-start-now"})},n}]),r.controller("mainController",["$scope","$http","$q","$sce","$timeout","ajaxService",function(o,n,r,s,l,i){var d=0,c="";o.getSession=function(e){i.getSession(e).then(function(e){o.dataStorage.global=e.data.arguments},function(e){var t=e.response.data,a="X-Transmission-Session-Id: ",n=t.indexOf(a),r=t.indexOf("</code>");if(n!==-1&&r!==-1)o.dataStorage.session=t.substring(n+(a.length-1),r),o.$emit("getSessionDone");else if(d+=1,1===d)c=(new Date).getTime();else if(5===d){var s=(new Date).getTime();c-s<=6e4?o.modal.show({type:"waring",content:"一分钟内请求Session失败次数过多，请检查网络或点击确定重新加载！",size:"small",btnType:2,submitFunc:function(){}}):d=0}})},o.getStatsData=function(){i.getSessionStats(o.dataStorage.session).then(function(e){o.dataStorage.stats=e.data.arguments,o.dataStorage.totalSpeed.download=o.dataStorage.stats.downloadSpeed,o.dataStorage.totalSpeed.upload=o.dataStorage.stats.uploadSpeed,o.$emit("getStatsDone")},function(e){console.log("查询stats失败")})},o.getRecentlyActiveTorrentData=function(){o.pool.ajax.activeTorrent=i.getActiveTorrent(o.dataStorage.session),o.pool.ajax.activeTorrent.promise.then(function(e){t.each(e.data.arguments.torrents,function(e,a){var n=t.findIndex(o.dataStorage.torrent,function(t){return t.id===e.id});n>-1&&t.merge(o.dataStorage.torrent[n],e)}),o.getTotalSpeed()},function(e){console.log("查询Torrent失败")})},o.sortTorrentData=function(){return o.dataStorage.torrent=t.sortBy(o.dataStorage.torrent,function(e){return-e.addedDate}),o.getTotalSpeed(),o.dataStorage.torrent},o.loopGetTorrentData=function(){o.pool.ajax.torrent=i.getTorrent(o.dataStorage.session),o.pool.ajax.torrent.promise.then(function(e){o.dataStorage.torrent=t.sortBy(e.data.arguments.torrents,function(e){return-e.addedDate}),o.dataStorage.ids=[],t.each(o.dataStorage.torrent,function(e,t){o.dataStorage.ids.push(e.id)}),o.pool.ajax.activeTorrent=o.getRecentlyActiveTorrentData(),o.pool.loop.activeTorrent=setInterval(function(){o.getRecentlyActiveTorrentData()},o.loopFragment.torrent)},function(e){console.log("查询Torrent失败")})},o.loopGetSessionData=function(){o.getSession(o.dataStorage.session),o.pool.loop.torrent=setInterval(function(){o.getSession(o.dataStorage.session)},o.loopFragment.session)},o.selectTorrent=function(e){return e!==o.dataStorage.selectedIndex&&(o.dataStorage.selectedIndex=e,void(o.detail.status===!0&&(o.detail.close(),o.detail.show())))},o.swip={left:function(){return o.modal.status!==!0&&void(o.getScreenWidth()<=1024&&(o.consolePanel.status===!1&&o.detail.status===!1?o.detail.show():o.consolePanel.status===!0&&o.detail.status===!1&&o.consolePanel.close()))},right:function(){return o.modal.status!==!0&&void(o.getScreenWidth()<=1024&&(o.consolePanel.status===!1&&o.detail.status===!0?o.detail.close():o.consolePanel.status===!1&&o.detail.status===!1&&o.consolePanel.show()))}},o.bytesConvert=function(e){var t={data:e,band:1e3};return a.bytesConvert(t)},o.parseFloat2=function(e){return a.parseFloat2(e)},o.parsTorrentClassName=function(e,t){var a="";switch(e){case 0:a="paused";break;case 4:a="downloading";break;case 6:a="seeding";break;default:a="seeding"}return t===o.dataStorage.selectedIndex&&(a+=" selected"),a},o.parseEta=function(e){var t="";return t=e===-1?"不可用":e===-2?"无法预估":a.secondsToTime(e)},o.parseFloat2=function(e){return a.parseFloat2(e)},o.getStatusText=function(e){var t="";switch(e.status){case 0:t=e.metaComplete<1?"磁性链接下载元数据中":"已暂停";break;case 4:t="下载中";break;case 6:t="做种中"}return t},o.howLong=function(e){return o.parseEta(parseInt((new Date).getTime()/1e3)-e)},o.getFullDate=function(e){return a.parseFullDate(e)},o.parseText={Status:function(e){var t=o.dataStorage.torrent[e],a="";switch(t.status){case 0:a+="已暂停";break;case 4:a+="下载自",a+="<span>"+t.peersSendingToUs+"/"+t.peersConnected+"个用户</span>",a+='<span class="icon-download">',a+=o.bytesConvert(t.rateDownload)+"/s",a+="</span>",a+='<span class="icon-upload">',a+=o.bytesConvert(t.rateUpload)+"/s",a+="</span>";break;case 6:a+="分享至",a+="<span>"+t.peersGettingFromUs+"/"+t.peersConnected+"个用户</span>",a+='<span class="icon-upload">',a+=o.bytesConvert(t.rateUpload)+"/s",a+="</span>"}return s.trustAsHtml(a)},TransformData:function(e){var t=o.dataStorage.torrent[e],n="";switch(t.status){case 0:t.metadataPercentComplete<1?(n+="磁性链接",n+="<span>",n+="下载元数据（"+(t.metadataPercentComplete<1?a.parseFloat2(100*t.metadataPercentComplete):"100")+"%）",n+="</span>"):(n+="已下载",n+="<span>",n+=o.bytesConvert(t.totalSize*(t.percentDone<1?t.percentDone:1))+"/"+o.bytesConvert(t.totalSize),n+="</span>",n+="<span>",n+="("+(t.percentDone<1?a.parseFloat2(100*t.percentDone):"100")+"%)",n+="</span>");break;case 4:t.metadataPercentComplete<1?n+="磁性链接<span> 下载元数据（"+(t.metadataPercentComplete<1?a.parseFloat2(100*t.metadataPercentComplete):"100")+"）</span>":(n+="已下载",n+="<span>",n+=o.bytesConvert(t.totalSize*(t.percentDone<1?t.percentDone:1))+"/"+o.bytesConvert(t.totalSize),n+="</span>",n+="<span>",n+="("+(t.percentDone<1?a.parseFloat2(100*t.percentDone):"100")+"%)",n+="</span>",t.uploadedEver>0&&(n+="<span>",n+="已上传",n+="</span>",n+="<span>",n+=o.bytesConvert(t.uploadedEver),n+="</span>"),o.getScreenWidth()>1024&&(n+="<span>",n+="预估剩余时间："+o.parseEta(t.eta),n+="</span>"));break;case 6:n+="已上传",n+="<span>",n+=o.bytesConvert(t.uploadedEver)+"/"+o.bytesConvert(t.totalSize),n+="</span>",n+="<span>",n+="分享率("+a.parseFloat2(t.uploadRatio)+"%)",n+="</span>",o.getScreenWidth()>1024&&(n+="<span>",n+="预估剩余时间："+o.parseEta(t.eta),n+="</span>")}return s.trustAsHtml(n)}},o.detail={target:e("#torrent-detail"),className:"show",tabNames:["info","peers","tracker","files"],tabSelect:function(e){o.detail.selectedTabIndex=e},status:!1,torrentData:!1,selectedTabIndex:0,show:function(){o.detail.status=o.detail.status!==!0,o.detail.status===!0?""!==o.dataStorage.selectedIndex&&(o.detail.torrentData=o.dataStorage.torrent[o.dataStorage.selectedIndex],o.pool.ajax.fullDetail=i.getFullDetail(o.dataStorage.session,[o.dataStorage.torrent[o.dataStorage.selectedIndex].id]),o.pool.ajax.fullDetail.promise.then(function(e){o.dataStorage.detail=e.data.arguments.torrents[0],o.pool.loop.detail=setInterval(function(){o.pool.ajax.detail=i.getDetail(o.dataStorage.session,[o.dataStorage.torrent[o.dataStorage.selectedIndex].id]),o.pool.ajax.detail.promise.then(function(e){o.dataStorage.detail=t.merge(o.dataStorage.detail,e.data.arguments.torrents[0])},function(e){console.log("维护明细数据失败")})},o.loopFragment.detail)},function(e){console.log("获取明细失败")})):o.detail.close()},close:function(){clearInterval(o.pool.loop.detail),o.detail.status=!1,o.closeAjax(o.pool.ajax.fullDetail),o.closeAjax(o.pool.ajax.detail)}},o.closeAjax=function(e){"object"==typeof e&&"function"==typeof e.resolve&&e.resolve()},o.reload={torrent:function(){clearInterval(o.pool.loop.activeTorrent),o.closeAjax(o.pool.ajax.torrent),o.closeAjax(o.pool.ajax.activeTorrent),o.loopGetTorrentData()},detail:function(){clearInterval(o.pool.loop.detail),o.closeAjax(o.pool.ajax.fullDetail),o.closeAjax(o.pool.ajax.detail)}};var u=function(t){var a=!0;return(0===o.dataStorage.torrent.length||void 0===t||0===t.length||1===t.length&&void 0===t[0])&&(a=!1),e(window).width()<=1024&&(o.consolePanel.status=!1),a};o.removeFromList=function(e){return u(e)!==!1&&void i.removeFromList(o.dataStorage.session,e).then(function(e){o.reload.torrent()},function(e){console.log("从下载列表中移除失败")})},o.removeFromList=function(e){return u(e)!==!1&&void i.removeAllData(o.dataStorage.session,e).then(function(e){o.reload.torrent()},function(e){console.log("从下载列表中移除失败")})},o.pauseTransform=function(e){return u(e)!==!1&&void i.pauseTransform(o.dataStorage.session,e).then(function(e){o.reload.torrent()},function(e){console.log("暂停传输任务请求失败！")})},o.startTransform=function(e){return u(e)!==!1&&void i.startTransform(o.dataStorage.session,e).then(function(e){o.reload.torrent()},function(e){console.log("暂停传输任务请求失败！")})},o.startTransformNow=function(e){return u(e)!==!1&&void i.startTransformNow(o.dataStorage.session,e).then(function(e){o.reload.torrent()},function(e){console.log("暂停传输任务请求失败！")})},o.consolePanel={status:!1,show:function(){o.consolePanel.status=!0},close:function(){o.consolePanel.status=!1}},o.modal={status:!1,isNeedTitle:!1,type:"add",size:"big",title:"测试标题",content:"添加传输任务失败！",btnType:2,btnText:{submit:"确定",cancel:"关闭"},submitFunc:function(){o.modal.close()},show:function(a,n){a.stopPropagation();var r="alpha";void 0!==n&&t.each(n,function(e,t){"show"!==t&&"close"!==t&&(o.modal[t]=e)}),o.modal.status=o.modal.status!==!0,l(function(){e("#modal-bg").addClass(r),e("#modal").addClass(r)},100)},close:function(){var t="alpha";e("#modal-bg").removeClass(t),e("#modal").removeClass(t),l(function(){o.modal.status=!1},550)}},e(document).click(function(){o.modal.status===!0&&o.modal.close()}),o.nav={status:!1,menudata:{name:["设置","计划任务运行","收缩视图","查看传输明细"],className:["icon-settings","icon-scheduled","icon-listview","icon-info-black"]},toggle:function(){o.nav.status=o.nav.status!==!0},close:function(e){o.nav.status=!1}},o.getTotalSpeed=function(){var e={download:0,upload:0};t.each(o.dataStorage.torrent,function(t,a){e.download+=void 0===t.rateDownload||null===t.rateDownload?0:t.rateDownload,e.upload+=void 0===t.rateUpload||null===t.rateUpload?0:t.rateUpload}),o.dataStorage.totalSpeed.download=e.download,o.dataStorage.totalSpeed.upload=e.upload},o.getScreenWidth=function(){return e(window).width()},o.init=function(){if(o.loopFragment={torrent:5e3,active:5e3,detail:5e3,session:15e3},o.getScreenWidth()>=1024){var e=window.document,t=e.documentElement,a=t.requestFullscreen||t.mozRequestFullScreen||t.webkitRequestFullScreen||t.msRequestFullscreen,n=e.exitFullscreen||e.mozCancelFullScreen||e.webkitExitFullscreen||e.msExitFullscreen;e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement?n.call(e):a.call(t)}if(o.pool={loop:{torrent:"",activeTorrent:"",session:"",detail:""},ajax:{torrent:{},activeTorrent:{},detail:{},fullDetail:{},sessionStats:{},session:{},remove:{},add:{},pause:{}}},o.dataStorage={session:"",global:{},torrent:[],selectedIndex:"",stats:{},ids:[],detail:{},test:0,totalSpeed:{download:0,upload:0}},o.localMode=!0,o.localMode===!0){var s=r.defer();require(["localData"],function(e){s.resolve(e)}),s.promise.then(function(e){o.dataStorage={global:e.global,torrent:e.torrent,selectedIndex:e.selectedIndex,stats:e.stats,ids:e.ids,detail:e.detail},o.getTotalSpeed()},function(e){})}var l=setInterval(function(){o.getSession()},3e3);o.$on("getSessionDone",function(e){clearInterval(l),o.loopGetSessionData(),o.getStatsData()}),o.$on("getStatsDone",function(){o.loopGetTorrentData()}),o.tmpUrl={detail:"template/detail.html",blankDetail:"template/blankdetail.html",tips:"template/tips.html",settings:"template/settings.html",modal:"template/tips.html"},document.addEventListener("touchstart",function(e){e.cancelable&&(e.defaultPrevented||e.preventDefault())},!1)},o.init()}]),r.directive("includeReplace",function(){return{require:"ngInclude",restrict:"A",link:function(e,t,a){t.replaceWith(t.children())}}}),r});
//# sourceMappingURL=maps/initConfig.min.js.map
