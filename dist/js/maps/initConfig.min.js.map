{"version":3,"sources":["initConfig.js"],"names":["define","$","_","tr","angularAMD","app","angular","module","$app","bootstrap","factory","$http","$q","ajax","op","deferred","defer","method","url","baseUrl","undefined","headers","sessionId","X-Transmission-Session-Id","data","param","when","response","status","config","resolve","reject","errService","err","cancel","promise","service","getSession","getSessionStats","serviceAruments","all","torrentSame","detailSame","getTorrent","arguments","fields","concat","getActiveTorrent","ids","getFullDetail","getDetail","addTransform","params","startTorrent","stopTorrent","removeFromList","removeAllData","delete-local-data","pauseTransform","startTransform","startTransformNow","portTest","saveSettings","setPriority","idsArr","priorityType","priorityIndexArr","controller","$scope","$sce","$timeout","$window","$document","$compile","ajaxService","baseTmpUrl","detailTemplateLoaded","tmpUrl","detail","tips","settings","modal","about","statics","addFiles","pool","loop","torrent","activeTorrent","session","sessionStats","detailSpeedChart","fullDetail","remove","add","pause","dataStorage","globalOrignal","global","alt-speed-down","alt-speed-up","alt-speed-time-begin","alt-speed-time-end","alt-speed-time-day","selectedIndex","stats","port-test","searchText","name","totalSpeed","download","upload","speed-limit-times","start","min","parseTime","mins","str","hour","$mins","parseInt","i","push","key","value","speed-limit-day","encryption","metainfo","filename","download-dir","paused","loopFragment","active","speedChartData","xAxis","sesseionErrCount","errStartTime","then","reason","val","temp","indexOf","end","substring","length","$emit","Date","getTime","now","stopAllAjax","show","type","title","content","btnText","submit","btnType","submitFunc","location","reload","loopGetSession","setInterval","getStatsData","init","downloadSpeed","uploadSpeed","activeErrCount","activeStartTime","getRecentlyActiveTorrentData","each","torrents","index","$index","findIndex","o","id","merge","total","oldMax","newMax","getTotalSpeed","speedChart","option","time","splice","getFullTime","textStyle","align","yAxia","parseFloat","bytesConvert","band","spliceUnit","num","series","torrentData","rateDownload","rateUpload","max","setOption","clearInterval","closeAjax","loopGetTorrentData","sortBy","item","addedDate","obj","allLoaded","addClass","setTimeout","removeClass","selectTorrent","compileTemplate","close","swip","left","nav","getScreenWidth","consolePanel","right","up","$event","down","bytes","parseFloat2","parsTorrentClassName","className","metadataPercentComplete","parseEta","eta","secondsToTime","howLong","getFullDate","ms","parseFullDate","parseText","Status","html","isFinished","percentDone","seedRatioLimit","uploadRatio","recheckProgress","peersSendingToUs","peersConnected","peersGettingFromUs","trustAsHtml","TransformData","totalSize","uploadedEver","toFixed","getProgessBarWidth","width","floorToPercent","getRatioPercent","initPartOfChartData","arr","target","tabNames","tabSelect","selectedTabIndex","allPriorityStatus","chartMaxMode","toggleChartMaxMode","options","yAxis","noneBlankTemplate","$type","loopGetDetail","$response","every","fileStats","changePriority","l","size","require","echarts","echartsLoaded","text","tooltip","trigger","legend","toolbox","feature","saveAsImage","grid","top","bottom","containLabel","splitLine","axisLine","lineStyle","color","axisTick","axisLabel","boundaryGap","splitNumber","minInterval","silent","smooth","showAllSymbol","areaStyle","normal","graphic","LinearGradient","offset","showSymbol","itemStyle","opacity","partOfData","$apply","document","getElementById","window","resize","console","log","$partOfData","dbshow","parseErrorText","error","errorString","setting","isAllLoaded","validationIDS","result","stopPropagation","tmp","files","promiseFlag","errFlag","reader","FileReader","onload","e","contents","join","readAsDataURL","submitSettings","isNeedTitle","tempatesUrl","selectTagContent","tag","swipLeft","swipRight","toggle","menudata","copy","alt-speed-enabled","parseMenuVisible","detailTemplateLoad","$watch","newValue","oldValue","localMode","localData","$on","event","addEventListener","cancelable","defaultPrevented","preventDefault","directive","restrict","link","scope","el","attrs","replaceWith","children"],"mappings":"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","file":"../initConfig.min.js","sourcesContent":["/**\r\n * Created by vincent on 2017/3/4.\r\n */\r\n\r\ndefine([\"jquery\", \"lodash\", \"transmission\", \"angularAMD\", \"mnTouch\"], function($, _, tr, angularAMD) {\r\n    \"use strict\";\r\n\r\n    var app = angular.module(\"transmission\", [\"mn\"]);\r\n\r\n    var $app = angularAMD.bootstrap(app);\r\n\r\n    $app.factory(\"ajaxService\", [\"$http\", \"$q\", function($http, $q) {\r\n        var service = {};\r\n        var baseUrl = \"/transmission/rpc\";\r\n\r\n        function ajax(op) {\r\n            var deferred = $q.defer();\r\n            var ajax = $http({\r\n                method: \"POST\",\r\n                url: baseUrl + (op.url !== undefined ? op.url : \"\"),\r\n                headers: op.sessionId !== undefined ? { \"X-Transmission-Session-Id\": op.sessionId } : {},\r\n                data: (function() {\r\n                    var param = {};\r\n                    switch (op.param.method) {\r\n                        case \"torrent-get\":\r\n                            param = op.param;\r\n                            break;\r\n                        case \"torrent-remove\":\r\n                            param = op.param;\r\n                            break;\r\n                        default:\r\n                            param = op.param;\r\n                            break;\r\n                    }\r\n                    return param;\r\n                })()\r\n            });\r\n\r\n            $q.when(ajax, function(response, status, headers, config) {\r\n                deferred.resolve(response, status, headers, config);\r\n            }, function(response, status) {\r\n                if (status !== 0) {\r\n                    deferred.reject({\r\n                        errService: op.errService ? op.errService : \"Service Error\",\r\n                        err: op.err,\r\n                        response: response,\r\n                        status: status\r\n                    });\r\n                }\r\n            });\r\n\r\n            return op.cancel === true ? deferred : deferred.promise;\r\n        }\r\n\r\n        service.getSession = function(sessionId) {\r\n            return ajax({\r\n                sessionId: sessionId,\r\n                param: {\r\n                    method: \"session-get\"\r\n                },\r\n                url: \"?type=getSession\",\r\n                cancel: true\r\n            });\r\n        };\r\n\r\n        service.getSessionStats = function(sessionId) {\r\n            return ajax({\r\n                sessionId: sessionId,\r\n                param: {\r\n                    method: \"session-stats\"\r\n                },\r\n                url: \"?type=getSessionStats\"\r\n            });\r\n        };\r\n\r\n        var serviceAruments = {\r\n            all:[\"id\"],\r\n            torrentSame: [\"error\", \"errorString\", \"eta\", \"isFinished\", \"isStalled\", \"leftUntilDone\", \"metadataPercentComplete\", \"peersConnected\", \"peersGettingFromUs\", \"peersSendingToUs\", \"percentDone\", \"queuePosition\", \"rateDownload\", \"rateUpload\", \"recheckProgress\", \"seedRatioMode\", \"seedRatioLimit\", \"sizeWhenDone\", \"status\", \"trackers\", \"downloadDir\", \"uploadedEver\", \"uploadRatio\", \"webseedsSendingToUs\"],\r\n            detailSame:[\"activityDate\",\"corruptEver\",\"desiredAvailable\",\"downloadedEver\",\"fileStats\",\"haveUnchecked\",\"haveValid\",\"peers\",\"startDate\",\"trackerStats\"]\r\n        };\r\n\r\n        service.getTorrent = function(sessionId) {\r\n            return ajax({\r\n                sessionId: sessionId,\r\n                param: {\r\n                    method: \"torrent-get\",\r\n                    arguments: {\r\n                        \"fields\": _.concat(serviceAruments.all,serviceAruments.torrentSame,[\r\n                            \"addedDate\",\r\n                            \"name\",\r\n                            \"totalSize\"\r\n                        ])\r\n                    }\r\n                },\r\n                url: \"?type=getTorrent\",\r\n                cancel: true\r\n            });\r\n        };\r\n\r\n        service.getActiveTorrent = function(sessionId) {\r\n            return ajax({\r\n                sessionId: sessionId,\r\n                param: {\r\n                    method: \"torrent-get\",\r\n                    arguments: {\r\n                        fields: _.concat(serviceAruments.all,serviceAruments.torrentSame),\r\n                        ids: \"recently-active\"\r\n                    }\r\n                },\r\n                url: \"?type=getActiveTorrent\",\r\n                cancel: true\r\n            });\r\n        };\r\n\r\n        service.getFullDetail = function(sessionId, ids) {\r\n            return ajax({\r\n                sessionId: sessionId,\r\n                param: {\r\n                    \"method\": \"torrent-get\",\r\n                    \"arguments\": {\r\n                        \"fields\": _.concat(serviceAruments.all,serviceAruments.detailSame,[\r\n                            \"comment\",\r\n                            \"creator\",\r\n                            \"dateCreated\",\r\n                            \"files\",\r\n                            \"hashString\",\r\n                            \"isPrivate\",\r\n                            \"pieceCount\",\r\n                            \"pieceSize\"\r\n                        ]),\r\n                        \"ids\": ids\r\n                    }\r\n                },\r\n                url: \"?type=getFullDetail\",\r\n                cancel: true\r\n            });\r\n        };\r\n\r\n        service.getDetail = function(sessionId, ids) {\r\n            return ajax({\r\n                \"sessionId\": sessionId,\r\n                \"param\": {\r\n                    \"method\": \"torrent-get\",\r\n                    \"arguments\": {\r\n                        \"fields\": _.concat(serviceAruments.all,serviceAruments.detailSame),\r\n                        \"ids\": ids\r\n                    }\r\n                },\r\n                \"url\": \"?type=getDetail\",\r\n                \"cancel\": true\r\n            });\r\n        };\r\n\r\n        service.addTransform = function(sessionId,params) {\r\n            return ajax({\r\n                sessionId: sessionId,\r\n                param: {\r\n                    \"method\": \"torrent-add\",\r\n                    \"arguments\":params\r\n                },\r\n                url: \"?type=torrent-add\"\r\n            });\r\n        };\r\n\r\n        service.startTorrent = function(sessionId) {\r\n            return ajax({\r\n                sessionId: sessionId,\r\n                param: {\r\n                    \"method\": \"torrent-start\"\r\n                },\r\n                url: \"?type=startTorrent\"\r\n            });\r\n        };\r\n\r\n        service.stopTorrent = function(sessionId) {\r\n            return ajax({\r\n                sessionId: sessionId,\r\n                param: {\r\n                    method: \"torrent-stop\"\r\n                },\r\n                url: \"?type=stopTorrent\"\r\n            });\r\n        };\r\n\r\n        service.removeFromList = function(sessionId, ids) {\r\n            return ajax({\r\n                sessionId: sessionId,\r\n                param: {\r\n                    \"method\": \"torrent-remove\",\r\n                    \"arguments\": {\r\n                        \"ids\": ids\r\n                    }\r\n                },\r\n                url: \"?type=removeFromList\"\r\n            });\r\n        };\r\n\r\n        service.removeAllData = function(sessionId, ids) {\r\n            return ajax({\r\n                sessionId: sessionId,\r\n                param: {\r\n                    \"method\": \"torrent-remove\",\r\n                    \"arguments\": {\r\n                        \"delete-local-data\": true,\r\n                        \"ids\": ids\r\n                    }\r\n                },\r\n                url: \"?type=removeAllData\"\r\n            });\r\n        };\r\n\r\n        service.pauseTransform = function(sessionId, ids) {\r\n            return ajax({\r\n                sessionId: sessionId,\r\n                param: {\r\n                    \"method\": \"torrent-stop\",\r\n                    \"arguments\": {\r\n                        \"ids\": ids\r\n                    }\r\n                },\r\n                url: \"?type=torrent-stop\"\r\n            });\r\n        };\r\n\r\n        service.startTransform = function(sessionId, ids) {\r\n            return ajax({\r\n                sessionId: sessionId,\r\n                param: {\r\n                    \"method\": \"torrent-start\",\r\n                    \"arguments\": {\r\n                        \"ids\": ids\r\n                    }\r\n                },\r\n                url: \"?type=torrent-start\"\r\n            });\r\n        };\r\n\r\n        service.startTransformNow = function(sessionId, ids) {\r\n            return ajax({\r\n                sessionId: sessionId,\r\n                param: {\r\n                    \"method\": \"torrent-start-now\",\r\n                    \"arguments\": {\r\n                        \"ids\": ids\r\n                    }\r\n                },\r\n                url: \"?type=torrent-start-now\"\r\n            });\r\n        };\r\n\r\n        service.portTest = function (sessionId) {\r\n            return ajax({\r\n                sessionId: sessionId,\r\n                param: {\r\n                    \"method\": \"port-test\"\r\n                },\r\n                url: \"?type=port-test\"\r\n            });\r\n        };\r\n\r\n        service.saveSettings = function (sessionId,params) {\r\n            return ajax({\r\n                sessionId: sessionId,\r\n                param: {\r\n                    \"method\": \"session-set\",\r\n                    \"arguments\": params\r\n                },\r\n                url: \"?type=saveSettings\"\r\n            });\r\n        };\r\n\r\n        service.setPriority = function (sessionId,op) {\r\n            return ajax({\r\n                sessionId: sessionId,\r\n                param: {\r\n                    \"method\": \"torrent-set\",\r\n                    \"arguments\": (function(){\r\n                        var params = {\r\n                            \"ids\":op.idsArr\r\n                        };\r\n\r\n                        params[op.priorityType] = op.priorityIndexArr;\r\n\r\n                        return params;\r\n                    })()\r\n                },\r\n                url: \"?type=torrent-set\"\r\n            });\r\n        };\r\n        return service;\r\n    }]);\r\n\r\n    $app.controller(\"mainController\", [\"$scope\", \"$http\", \"$q\", \"$sce\", \"$timeout\", \"$window\", \"$document\", \"$compile\", \"ajaxService\", function($scope, $http, $q, $sce, $timeout, $window, $document, $compile, ajaxService) {\r\n\r\n        var baseTmpUrl = \"template/\";\r\n        $scope.detailTemplateLoaded = false;\r\n        $scope.tmpUrl = {\r\n            detail: baseTmpUrl + \"detail.html\",\r\n            tips:  \"modal_t\",\r\n            settings:  \"settings\",\r\n            modal: \"modal_t\",\r\n            about: \"about\",\r\n            statics: \"statics\",\r\n            addFiles: \"addFiles\"\r\n        };\r\n\r\n        //loop pool\r\n        $scope.pool = {\r\n            \"loop\": {\r\n                \"torrent\": 0,\r\n                \"activeTorrent\": 0,\r\n                \"session\": 0,\r\n                \"sessionStats\":0,\r\n                \"detail\": 0,\r\n                \"detailSpeedChart\":0\r\n            },\r\n            \"ajax\": {\r\n                \"torrent\": {},\r\n                \"activeTorrent\": {},\r\n                \"detail\": {},\r\n                \"fullDetail\": {},\r\n                \"sessionStats\":{},\r\n                \"session\":{},\r\n                \"remove\":{},\r\n                \"add\":{},\r\n                \"pause\":{}\r\n            }\r\n        };\r\n\r\n        //数据\r\n        $scope.dataStorage = {\r\n            \"session\": \"\",\r\n            \"globalOrignal\":{},\r\n            \"global\": {\r\n                \"alt-speed-down\":0,\r\n                \"alt-speed-up\":0,\r\n                \"alt-speed-time-begin\":0,\r\n                \"alt-speed-time-end\":0,\r\n                \"alt-speed-time-day\":127\r\n                // \"encryption\":\"tolerated\"\r\n                // \"seedRatioLimited\":false,\r\n                // \"idle-seeding-limit-enabled\":false,\r\n                // \"speed-limit-up-enabled\":false,\r\n                // \"speed-limit-down-enabled\":false,\r\n                // \"alt-speed-time-enabled\":false,\r\n                // \"blocklist-enabled\":false\r\n            },\r\n            \"torrent\": [],\r\n            \"selectedIndex\": \"\",\r\n            \"stats\": {},\r\n            \"ids\": [],\r\n            \"detail\": {},\r\n            \"settings\":{},\r\n            \"port-test\":false,\r\n            \"searchText\":{\r\n                name:\"\"\r\n            },\r\n            \"totalSpeed\":{\r\n                download:0,\r\n                upload:0\r\n            },\r\n            \"speed-limit-times\":(function () {\r\n                var start = [];\r\n                var min = 0;\r\n                var parseTime = function (mins) {\r\n                    var str = \"\";\r\n                    var hour = 0;\r\n                    var $mins = 0;\r\n\r\n                    if (mins < 60) {\r\n                        str = \"00:\" + (mins < 10 ? \"0\" + mins : mins);\r\n                    } else {\r\n                        hour = parseInt(mins / 60);\r\n                        $mins = mins - (hour * 60);\r\n                        str = (hour < 10 ? \"0\" + hour : hour) + \":\" + ($mins === 0 ? \"00\" : $mins);\r\n                    }\r\n\r\n                    return str;\r\n                };\r\n                for (var i = 0; i < 96; i++) {\r\n                    start.push({key:parseTime(min),value:min});\r\n                    min += 15;\r\n                }\r\n                return start;\r\n            })(),\r\n            \"speed-limit-day\":[\r\n                {\"key\":\"每天\",\"value\":127},\r\n                {\"key\":\"工作日\",\"value\":62},\r\n                {\"key\":\"周末\",\"value\":65},\r\n                {\"key\":\"星期天\",\"value\":1},\r\n                {\"key\":\"星期一\",\"value\":2},\r\n                {\"key\":\"星期二\",\"value\":4},\r\n                {\"key\":\"星期三\",\"value\":8},\r\n                {\"key\":\"星期四\",\"value\":16},\r\n                {\"key\":\"星期五\",\"value\":32},\r\n                {\"key\":\"星期六\",\"value\":64}\r\n            ],\r\n            \"encryption\":[\r\n                {\"key\":\"允许加密\",\"value\":\"tolerated\"},\r\n                {\"key\":\"喜欢加密\",\"value\":\"preferred\"},\r\n                {\"key\":\"需要加密\",\"value\":\"required\"}\r\n            ],\r\n            \"addTransform\":{\r\n                \"metainfo\":[],\r\n                \"filename\":\"\",\r\n                \"download-dir\":\"123123\",\r\n                \"paused\":true\r\n            }\r\n        };\r\n\r\n        $scope.loopFragment = {\r\n            torrent: 5000,\r\n            active: 5000,\r\n            detail: 5000,\r\n            session: 15000\r\n        };\r\n\r\n        $scope.speedChartData = {\r\n            xAxis:[],\r\n            download:[],\r\n            upload:[]\r\n        };\r\n\r\n        //获取session\r\n        var sesseionErrCount = 0;\r\n        var errStartTime = \"\";\r\n        $scope.getSession = function(session) {\r\n\r\n            //获取session\r\n            $scope.pool.ajax.session = ajaxService.getSession(session);\r\n            $scope.pool.ajax.session.promise.then(function(response) {\r\n                sesseionErrCount = 0;\r\n                $scope.dataStorage.global = response.data.arguments;\r\n                // $scope.dataStorage.globalOrignal = _.clone(response.data.arguments);\r\n            }, function(reason) {\r\n                var val = true;\r\n                var str = reason.response.data;\r\n                if(str === null){\r\n                    val = false;\r\n                }\r\n\r\n                if(val === true){\r\n                    var temp = \"X-Transmission-Session-Id: \";\r\n                    var start = str.indexOf(temp);\r\n                    var end = str.indexOf(\"<\\/code>\");\r\n                    if(start !== -1 && end !== -1){\r\n                        $scope.dataStorage.session = str.substring((start + (temp.length - 1)), end);\r\n                        $scope.$emit(\"getSessionDone\");\r\n                    }else{\r\n                        val = false;\r\n                    }\r\n                }\r\n\r\n                if(val === false){\r\n                    //1分钟内连续错误5次则直接停止所有异步请求，并提示\r\n                    sesseionErrCount += 1;\r\n                    if(sesseionErrCount === 1){\r\n                        errStartTime = new Date().getTime();\r\n                    }else if(sesseionErrCount >= 5){\r\n                        var now = new Date().getTime();\r\n                        if((now - errStartTime) <= 180000){\r\n                            $scope.stopAllAjax();\r\n                            $scope.modal.show({\r\n                                type:\"waring\",\r\n                                title:\"一分钟内请求Session失败次数过多\",\r\n                                content:\"请检查您的网络是否顺畅，或点击刷新尝试解决！\",\r\n                                btnText:{\r\n                                    submit:\"刷新\"\r\n                                },\r\n                                btnType : 2,\r\n                                submitFunc : function () {\r\n                                    $window.location.reload();\r\n                                }\r\n                            });\r\n                        }else{\r\n                            sesseionErrCount = 0;\r\n                            errStartTime = new Date().getTime();\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        };\r\n\r\n        //循环获取session数据\r\n        $scope.loopGetSession = function() {\r\n            $scope.getSession($scope.dataStorage.session);\r\n            $scope.pool.loop.session = setInterval(function() {\r\n                $scope.getSession($scope.dataStorage.session);\r\n            }, $scope.loopFragment.session);\r\n        };\r\n\r\n        //获取统计信息\r\n        $scope.getStatsData = function(init) {\r\n            //获取session\r\n            $scope.pool.ajax.sessionStats = ajaxService.getSessionStats($scope.dataStorage.session).then(function(response) {\r\n                $scope.dataStorage.stats = response.data.arguments;\r\n                if(init === \"init\"){\r\n                    $scope.dataStorage.totalSpeed.download = $scope.dataStorage.stats.downloadSpeed;\r\n                    $scope.dataStorage.totalSpeed.upload = $scope.dataStorage.stats.uploadSpeed;\r\n                    $scope.$emit(\"getStatsDone\");\r\n                }\r\n            }, function(reason) {\r\n                $scope.modal.show({\r\n                    type:\"waring\",\r\n                    title:\"查询统计数据失败\",\r\n                    content:\"请检查您的网络是否顺畅，或点击重载尝试重新加载一次统计数据！\",\r\n                    btnText:{\r\n                        submit:\"重载\"\r\n                    },\r\n                    btnType : 2,\r\n                    submitFunc : function () {\r\n                        $scope.getStatsData();\r\n                    }\r\n                });\r\n            });\r\n        };\r\n\r\n        //获取正在活动的Torrent数据\r\n        var activeErrCount = 0;\r\n        var activeStartTime = 0;\r\n        $scope.getRecentlyActiveTorrentData = function() {\r\n            //获取活动中的torrent数据\r\n            $scope.pool.ajax.activeTorrent = ajaxService.getActiveTorrent($scope.dataStorage.session);\r\n            $scope.pool.ajax.activeTorrent.promise.then(function(response) {\r\n                activeErrCount = 0;\r\n                //替换数据列表中对应的数据\r\n                _.each(response.data.arguments.torrents, function(value, index) {\r\n                    var $index = _.findIndex($scope.dataStorage.torrent, function(o) {\r\n                        return o.id === value.id;\r\n                    });\r\n\r\n                    if ($index > -1) {\r\n                        _.merge($scope.dataStorage.torrent[$index], value);\r\n                    }\r\n                });\r\n\r\n                var total = {\r\n                    \"oldMax\":{\r\n                        download:$scope.dataStorage.totalSpeed.download,\r\n                        upload:$scope.dataStorage.totalSpeed.upload\r\n                    },\r\n                    \"newMax\":{\r\n                        download:0,\r\n                        upload:0\r\n                    }\r\n                };\r\n\r\n                $scope.getTotalSpeed();\r\n                total.newMax.download = $scope.dataStorage.totalSpeed.download;\r\n                total.newMax.upload = $scope.dataStorage.totalSpeed.upload;\r\n\r\n                if($scope.speedChart !== undefined && $scope.detail.status === true){\r\n                    var option ={\r\n                        xAxis:[{\r\n                            data:(function () {\r\n                                var time = new Date().getTime();\r\n                                $scope.speedChartData.xAxis.splice(0,1);\r\n                                $scope.speedChartData.xAxis.push({\r\n                                    value:tr.getFullTime(time),\r\n                                    textStyle:{\r\n                                        align :\"right\"\r\n                                    }\r\n                                });\r\n                                return $scope.speedChartData.xAxis;\r\n                            })()\r\n                        }],\r\n                        yAxia:[{\r\n                            data:parseFloat(tr.bytesConvert({\r\n                                data:$scope.dataStorage.totalSpeed.download,\r\n                                band:1024,\r\n                                spliceUnit:true\r\n                            }).num)\r\n                        },{\r\n                            data:parseFloat(tr.bytesConvert({\r\n                                data:$scope.dataStorage.totalSpeed.upload,\r\n                                band:1024,\r\n                                spliceUnit:true\r\n                            }).num)\r\n                        }],\r\n                        series:[{\r\n                            data:(function () {\r\n                                $scope.speedChartData.download.splice(0,1);\r\n                                $scope.speedChartData.download.push(tr.bytesConvert({\r\n                                    data:$scope.detail.torrentData.rateDownload,\r\n                                    band:1024,\r\n                                    spliceUnit:true\r\n                                }).num);\r\n                                return $scope.speedChartData.download;\r\n                            })()\r\n                        },{\r\n                            data:(function () {\r\n                                $scope.speedChartData.upload.splice(0,1);\r\n                                $scope.speedChartData.upload.push(tr.bytesConvert({\r\n                                    data:$scope.detail.torrentData.rateUpload,\r\n                                    band:1024,\r\n                                    spliceUnit:true\r\n                                }).num);\r\n                                return $scope.speedChartData.upload;\r\n                            })()\r\n                        }]\r\n                    };\r\n\r\n                    //解析总上传速度和下载速度是否需要更新\r\n                    if(total.oldMax.download !== total.newMax.download || total.oldMax.upload !== total.newMax.upload){\r\n                        option.yAxia = [\r\n                            {\r\n                                max:total.oldMax.download\r\n                            },\r\n                            {\r\n                                max:total.oldMax.upload\r\n                            }\r\n                        ];\r\n                        if(total.oldMax.download !== total.newMax.download && total.oldMax.upload === total.newMax.upload){\r\n                            option.yAxia[0].data = parseFloat(tr.bytesConvert({\r\n                                data:total.newMax.download,\r\n                                band:1024,\r\n                                spliceUnit:true\r\n                            }).num);\r\n                        }else if(total.oldMax.download === total.newMax.download && total.oldMax.upload !== total.newMax.upload){\r\n                            option.yAxia[1].data = parseFloat(tr.bytesConvert({\r\n                                data:total.newMax.upload,\r\n                                band:1024,\r\n                                spliceUnit:true\r\n                            }).num);\r\n                        }\r\n                    }\r\n\r\n                    $scope.speedChart.setOption(option);\r\n                    $scope.speedChartData.xAxis = option.xAxis[0].data;\r\n                    $scope.speedChartData.download = option.series[0].data;\r\n                    $scope.speedChartData.upload = option.series[1].data;\r\n                }\r\n            }, function(reason) {\r\n                activeErrCount += 1;\r\n                if(activeErrCount === 1){\r\n                    activeStartTime = new Date().getTime();\r\n                }else if(sesseionErrCount >= 5){\r\n                    var now = new Date().getTime();\r\n                    if((now - activeStartTime) <= 60000){\r\n                        clearInterval($scope.pool.loop.activeTorrent);\r\n                        $scope.closeAjax($scope.pool.ajax.torrent);\r\n                        $scope.modal.show({\r\n                            type:\"waring\",\r\n                            title:\"短期内多次查询活动任务失败\",\r\n                            content:\"请检查您的网络是否顺畅，或点击重载尝试重新加载一次活动任务数据！\",\r\n                            btnText:{\r\n                                submit:\"重载\"\r\n                            },\r\n                            btnType : 2,\r\n                            submitFunc : function () {\r\n                                $scope.loopGetTorrentData();\r\n                            }\r\n                        });\r\n                    }else{\r\n                        activeErrCount = 0;\r\n                        activeStartTime = new Date().getTime();\r\n                    }\r\n                }\r\n            });\r\n        };\r\n\r\n        //循环获取种子数据\r\n        $scope.loopGetTorrentData = function() {\r\n            //get all torrent(list)\r\n            $scope.pool.ajax.torrent = ajaxService.getTorrent($scope.dataStorage.session);\r\n            $scope.pool.ajax.torrent.promise.then(function(response) {\r\n\r\n                //对种子排序\r\n                $scope.dataStorage.torrent = _.sortBy(response.data.arguments.torrents, function(item) {\r\n                    return -item.addedDate;\r\n                });\r\n\r\n                $scope.dataStorage.torrent = response.data.arguments.torrents;\r\n\r\n                $scope.dataStorage.ids = [];\r\n                _.each($scope.dataStorage.torrent, function(obj, index) {\r\n                    $scope.dataStorage.ids.push(obj.id);\r\n                });\r\n\r\n                $scope.allLoaded = true;\r\n                $(\"#loading\").addClass(\"loading-hide\");\r\n                setTimeout(function () {\r\n                    $(\"#loading\").remove();\r\n                },1000);\r\n\r\n                $(\".hide\").removeClass(\"hide\");\r\n\r\n                //loop the active torrent\r\n                $scope.pool.ajax.activeTorrent = $scope.getRecentlyActiveTorrentData();\r\n                $scope.pool.loop.activeTorrent = setInterval(function() {\r\n                    $scope.getRecentlyActiveTorrentData();\r\n                }, $scope.loopFragment.torrent);\r\n            }, function(reason) {\r\n                $scope.modal.show({\r\n                    type:\"waring\",\r\n                    title:\"获取传输任务列表数据失败\",\r\n                    content:\"请检查您的网络是否顺畅，或点击重载重新加载任务列表一次！\",\r\n                    btnText:{\r\n                        submit:\"重载\"\r\n                    },\r\n                    btnType : 2,\r\n                    submitFunc : function () {\r\n                        $scope.loopGetTorrentData();\r\n                    }\r\n                });\r\n            });\r\n        };\r\n\r\n        //选择某下载任务\r\n        $scope.selectTorrent = function(index) {\r\n\r\n            if (index === $scope.dataStorage.selectedIndex) {\r\n                return false;\r\n            }\r\n\r\n            // console.log($scope.dataStorage.torrent[index]);\r\n\r\n            $scope.dataStorage.selectedIndex = index;\r\n            $scope.detail.compileTemplate();\r\n            if ($scope.detail.status === true) {\r\n                $scope.detail.close();\r\n                $scope.detail.show();\r\n            }\r\n        };\r\n\r\n        //滑动操作\r\n        $scope.swip = {\r\n            left: function() {\r\n\r\n                if($scope.modal.status === true){\r\n                    return false;\r\n                }\r\n\r\n                if($scope.nav.status === true){\r\n                    $scope.nav.close();\r\n                }\r\n\r\n                if ($scope.getScreenWidth() <= 1024) {\r\n                    if ($scope.consolePanel.status === false && $scope.detail.status === false) {\r\n                        $scope.detail.show();\r\n                    } else if ($scope.consolePanel.status === true && $scope.detail.status === false) {\r\n                        $scope.consolePanel.close();\r\n                    }\r\n                }\r\n            },\r\n            right: function() {\r\n\r\n                if($scope.modal.status === true){\r\n                    return false;\r\n                }\r\n\r\n                if($scope.nav.status === true){\r\n                    $scope.nav.close();\r\n                }\r\n\r\n                if ($scope.getScreenWidth() <= 1024) {\r\n                    if ($scope.consolePanel.status === false && $scope.detail.status === true) {\r\n                        $scope.detail.close();\r\n                    } else if ($scope.consolePanel.status === false && $scope.detail.status === false) {\r\n                        $scope.consolePanel.show();\r\n                    }\r\n                }\r\n            },\r\n            up:function ($event) {\r\n                if($scope.modal.status === true || $scope.consolePanel.status === true || $scope.detail.status === true){\r\n                    return false;\r\n                }else{\r\n                    $scope.nav.close($event);\r\n                }\r\n            },\r\n            down:function () {\r\n                if($scope.modal.status === true || $scope.consolePanel.status === true || $scope.detail.status === true){\r\n                    return false;\r\n                }else{\r\n                    $scope.nav.show();\r\n                }\r\n            }\r\n        };\r\n\r\n        //流量转换\r\n        $scope.bytesConvert = function(bytes) {\r\n            var op = {\r\n                \"data\": bytes,\r\n                \"band\": 1000\r\n            };\r\n            return tr.bytesConvert(op);\r\n        };\r\n\r\n        //分析已下载数据\r\n        $scope.parseFloat2 = function(num) {\r\n            return tr.parseFloat2(num);\r\n        };\r\n\r\n        //解析下载任务的样式名\r\n        $scope.parsTorrentClassName = function(status, index) {\r\n            var data= $scope.dataStorage.torrent[index];\r\n            var className = \"\";\r\n            //4正在下载\r\n            switch (status) {\r\n                case 0:\r\n                    className = \"paused\";\r\n                    break;\r\n                case 2:\r\n                    className = \"rechecking\";\r\n                    break;\r\n                case 4:\r\n                    className = data.metadataPercentComplete < 1?\"rechecking\":\"downloading\";\r\n                    break;\r\n                case 6:\r\n                    className = \"seeding\";\r\n                    break;\r\n                default:\r\n                    className = \"seeding\";\r\n                    break;\r\n            }\r\n            if (index === $scope.dataStorage.selectedIndex) {\r\n                className += \" selected\";\r\n            }\r\n            return className;\r\n        };\r\n\r\n        //解析剩余时间\r\n        $scope.parseEta = function(eta) {\r\n            var str = \"\";\r\n            if (eta === -1) {\r\n                str = \"不可用\";\r\n            } else if (eta === -2) {\r\n                str = \"无法预估\";\r\n            } else {\r\n                str = tr.secondsToTime(eta);\r\n            }\r\n\r\n            return str;\r\n        };\r\n\r\n        $scope.parseFloat2 = function(num) {\r\n            return tr.parseFloat2(num);\r\n        };\r\n\r\n        //获取运行时长\r\n        $scope.howLong = function(start) {\r\n            return $scope.parseEta(parseInt((new Date().getTime()) / 1000) - start);\r\n        };\r\n\r\n        $scope.getFullDate = function(ms) {\r\n            return tr.parseFullDate(ms);\r\n        };\r\n\r\n        //解析torrent列表文字\r\n        $scope.parseText = {\r\n            \"Status\": function(index) {\r\n                var data = $scope.dataStorage.torrent[index];\r\n                var html = \"\";\r\n\r\n                switch (data.status) {\r\n                    case 0:\r\n                        // className = \"paused\";\r\n                        if(data.isFinished === true){\r\n                            html += \"\";\r\n                        }else{\r\n                            html += \"已暂停\";\r\n                        }\r\n                        if(data.percentDone < 1){\r\n                            html = \"已暂停\";\r\n                        }else {\r\n                            if (data.seedRatioLimit > data.uploadRatio) {\r\n                                html = \"已暂停做种\";\r\n                            }else{\r\n                                if (data.isFinished === true) {\r\n                                    html += \"已完成做种\";\r\n                                }\r\n                            }\r\n                        }\r\n                        break;\r\n                    case 1:\r\n                        //磁性链接\r\n                        // className = \"valMetaData\";\r\n                        // html += \"已暂停\";\r\n                        break;\r\n                    case 2:\r\n                        html += \"正在验证本底数据\";\r\n                        html += \"<span>(\" + (data.recheckProgress < 1 ? tr.parseFloat2(data.recheckProgress * 100) : \"100\") + \"% 已验证)</span>\";\r\n                        break;\r\n                    case 4:\r\n                        html += \"<span>下载自</span>\";\r\n                        html += \"<span>\" + data.peersSendingToUs + \"/\" + data.peersConnected + \"个用户</span>\";\r\n                        html += \"<span class=\\\"icon-download\\\">\";\r\n                        html += $scope.bytesConvert(data.rateDownload) + \"/s\";\r\n                        html += \"</span>\";\r\n                        html += \"<span class=\\\"icon-upload\\\">\";\r\n                        html += $scope.bytesConvert(data.rateUpload) + \"/s\";\r\n                        html += \"</span>\";\r\n                        break;\r\n                    case 6:\r\n                        html += \"<span>做种至</span>\";\r\n                        html += \"<span>\" + data.peersGettingFromUs + \"/\" + data.peersConnected + \"个用户</span>\";\r\n                        html += \"<span class=\\\"icon-upload\\\">\";\r\n                        html += $scope.bytesConvert(data.rateUpload) + \"/s\";\r\n                        html += \"</span>\";\r\n                        break;\r\n                    default:\r\n                        // className = \"seeding\";\r\n                        break;\r\n                }\r\n\r\n                return $sce.trustAsHtml(html);\r\n            },\r\n            \"TransformData\": function(index) {\r\n                var data = $scope.dataStorage.torrent[index];\r\n                var html = \"\";\r\n\r\n                switch (data.status) {\r\n                    case 0:\r\n                        // className = \"paused\";\r\n                        if (data.metadataPercentComplete < 1) {\r\n                            html += \"<span>磁性链接</span>\";\r\n                            html += \"<span>\";\r\n                            html += \"下载元数据（\" + (data.metadataPercentComplete < 1 ? tr.parseFloat2(data.metadataPercentComplete * 100) : \"100\") + \"%）\";\r\n                            html += \"</span>\";\r\n                        } else {\r\n                            html += \"<span>\";\r\n                            html += $scope.bytesConvert(data.totalSize * (data.percentDone < 1 ? data.percentDone : 1)) + \"/\" + $scope.bytesConvert(data.totalSize);\r\n                            html += \"</span>\";\r\n                            html += \"<span>\";\r\n                            html += \"(\" + (data.percentDone < 1 ? tr.parseFloat2(data.percentDone * 100) : \"100\") + \"%)\";\r\n                            html += \"</span>\";\r\n                        }\r\n                        break;\r\n                    case 2:\r\n                        html += \"<span>已下载</span>\";\r\n                        html += \"<span>\";\r\n                        html += $scope.bytesConvert(data.totalSize * (data.percentDone < 1 ? data.percentDone : 1)) + \"/\" + $scope.bytesConvert(data.totalSize);\r\n                        html += \"</span>\";\r\n                        html += \"<span>\";\r\n                        html += \"(\" + (data.percentDone < 1 ? tr.parseFloat2(data.percentDone * 100) : \"100\") + \"%)\";\r\n                        html += \"</span>\";\r\n                        if (data.uploadedEver > 0) {\r\n                            html += \"<span>\";\r\n                            html += \"已上传\";\r\n                            html += \"</span>\";\r\n                            html += \"<span>\";\r\n                            html += $scope.bytesConvert(data.uploadedEver);\r\n                            html += \"</span>\";\r\n                        }\r\n                        if ($scope.getScreenWidth() > 1024) {\r\n                            html += \"<span>\";\r\n                            html += \"预估剩余时间：\" + $scope.parseEta(data.eta);\r\n                            html += \"</span>\";\r\n                        }\r\n                        break;\r\n                    case 4:\r\n                        // className = \"downloading\";,\r\n                        if (data.metadataPercentComplete < 1) {\r\n                            html += \"<span>磁性链接</span><span> 下载元数据（\" + (data.metadataPercentComplete < 1 ? tr.parseFloat2(data.metadataPercentComplete * 100) : \"100\") + \"%）</span>\";\r\n                        } else {\r\n                            html += \"<span>已下载</span>\";\r\n                            html += \"<span>\";\r\n                            html += $scope.bytesConvert(data.totalSize * (data.percentDone < 1 ? data.percentDone : 1)) + \"/\" + $scope.bytesConvert(data.totalSize);\r\n                            html += \"</span>\";\r\n                            html += \"<span>\";\r\n                            html += \"(\" + (data.percentDone < 1 ? tr.parseFloat2(data.percentDone * 100) : \"100\") + \"%)\";\r\n                            html += \"</span>\";\r\n                            if (data.uploadedEver > 0) {\r\n                                html += \"<span>\";\r\n                                html += \"已上传\";\r\n                                html += \"</span>\";\r\n                                html += \"<span>\";\r\n                                html += $scope.bytesConvert(data.uploadedEver);\r\n                                html += \"</span>\";\r\n                            }\r\n                            if ($scope.getScreenWidth() > 1024) {\r\n                                html += \"<span>\";\r\n                                html += \"预估剩余时间：\" + $scope.parseEta(data.eta);\r\n                                html += \"</span>\";\r\n                            }\r\n                        }\r\n                        break;\r\n                    case 6:\r\n                        // className = \"seeding\";\r\n                        html += \"<span>已上传</span>\";\r\n                        html += \"<span>\";\r\n                        html += $scope.bytesConvert(data.uploadedEver) + \"/\" + $scope.bytesConvert(data.totalSize);\r\n                        html += \"</span>\";\r\n                        html += \"<span>\";\r\n                        // html += \"分享率(\" + tr.parseFloat2(data.uploadRatio) + \"%)\";\r\n                        html += \"分享率(\" + data.uploadRatio.toFixed(2) + \")\";\r\n                        html += \"</span>\";\r\n                        if ($scope.getScreenWidth() > 1024) {\r\n                            html += \"<span>\";\r\n                            html += \"预估剩余时间：\" + $scope.parseEta(data.eta);\r\n                            html += \"</span>\";\r\n                        }\r\n                        break;\r\n                    default:\r\n                        // className = \"seeding\";\r\n                        break;\r\n                }\r\n\r\n                return $sce.trustAsHtml(html);\r\n            }\r\n        };\r\n\r\n        $scope.getProgessBarWidth = function (index) {\r\n            var data = $scope.dataStorage.torrent[index];\r\n            var width = \"\";\r\n            switch (data.status) {\r\n                case 0:\r\n                    // className = \"paused\";\r\n                    if(data.percentDone < 1){\r\n                        width = tr.floorToPercent(data.percentDone);\r\n                    }else{\r\n                        width = data.seedRatioLimit <= data.uploadRatio?\"100%\":tr.getRatioPercent(data.seedRatioLimit,data.uploadRatio);\r\n                    }\r\n                    break;\r\n                case 2:\r\n                    break;\r\n                case 4:\r\n                    // className = \"downloading\";,percentDone\r\n                    if(data.metadataPercentComplete < 1){\r\n                        width = tr.floorToPercent(data.metadataPercentComplete);\r\n                    }else{\r\n                        width = tr.floorToPercent(data.percentDone);\r\n                    }\r\n                    break;\r\n                case 6:\r\n                    width = data.seedRatioLimit <= data.uploadRatio?\"100%\":tr.getRatioPercent(data.seedRatioLimit,data.uploadRatio);\r\n                    // className = \"seeding\";\r\n                    break;\r\n                default:\r\n                    width = data.seedRatioLimit <= data.uploadRatio?\"100%\":tr.getRatioPercent(data.seedRatioLimit,data.uploadRatio);\r\n                    // className = \"seeding\";\r\n                    break;\r\n            }\r\n            return width;\r\n        };\r\n\r\n        $scope.initPartOfChartData = function (torrentData) {\r\n            return {\r\n                \"xAxis\":[{\r\n                    data : (function () {\r\n                        var arr = [];\r\n                        var time = new Date().getTime();\r\n                        for(var i = 7;i > 0;i--){\r\n                            arr.push({\r\n                                value:tr.getFullTime(time - i*$scope.loopFragment.active),\r\n                                textStyle:{\r\n                                    align :\"right\"\r\n                                }\r\n                            });\r\n                        }\r\n                        arr.push({\r\n                            value:tr.getFullTime(time),\r\n                            textStyle:{\r\n                                align :\"right\"\r\n                            }\r\n                        });\r\n\r\n                        return arr;\r\n                    })()\r\n                }],\r\n                \"series\":[\r\n                    {\r\n                        data:(function(){\r\n                            var arr = [0, 0, 0, 0, 0, 0, 0];\r\n                            var data = tr.bytesConvert({\r\n                                data:torrentData.rateDownload,\r\n                                band:1024,\r\n                                spliceUnit:true\r\n                            });\r\n                            arr.push(parseFloat(data.num));\r\n                            return arr;\r\n                        })()\r\n                    },\r\n                    {\r\n                        data:(function(){\r\n                            var arr = [0, 0, 0, 0, 0, 0, 0];\r\n                            var data = tr.bytesConvert({\r\n                                data:torrentData.rateUpload,\r\n                                band:1024,\r\n                                spliceUnit:true\r\n                            });\r\n                            arr.push(parseFloat(data.num));\r\n                            return arr;\r\n                        })()\r\n                    }\r\n                ]\r\n            };\r\n        };\r\n\r\n        //明细\r\n        $scope.detail = {\r\n            \"target\": $(\"#torrent-detail\"),\r\n            \"className\": \"show\",\r\n            \"tabNames\": [\"info\", \"peers\", \"tracker\", \"files\"],\r\n            \"tabSelect\": function(index) {\r\n                $scope.detail.selectedTabIndex = index;\r\n            },\r\n            \"allPriorityStatus\":-2,\r\n            \"status\": false,\r\n            \"chartMaxMode\":false,//true 以总上限占比统计\r\n            \"toggleChartMaxMode\":function () {\r\n                if($scope.speedChart !== undefined){\r\n                    $scope.detail.chartMaxMode = $scope.detail.chartMaxMode !== true;\r\n                    var options = {\r\n                        yAxis:[\r\n                            {\r\n                                max:$scope.detail.chartMaxMode === true?$scope.dataStorage.global[\"alt-speed-down\"]:\"auto\"\r\n                            },\r\n                            {\r\n                                max:$scope.detail.chartMaxMode === true?$scope.dataStorage.global[\"alt-speed-up\"]:\"auto\"\r\n                            }\r\n                        ]\r\n                    };\r\n                    $scope.speedChart.setOption(options);\r\n                }\r\n            },\r\n            \"torrentData\": false,\r\n            \"selectedTabIndex\": 0,\r\n            \"noneBlankTemplate\":false,\r\n            \"compileTemplate\":function () {\r\n                if($scope.detail.noneBlankTemplate === true){return;}\r\n\r\n                var html = \"\";\r\n                var $type = typeof $scope.dataStorage.selectedIndex;\r\n\r\n                if($type === \"string\"){\r\n                    html = $(\"#blankDetail\").html();\r\n                }else if($type === \"number\" || ($type === \"object\" && $type.length !== undefined)){\r\n                    html = $(\"#detail\").html();\r\n                    $scope.detail.noneBlankTemplate = true;\r\n                }\r\n\r\n                $(\"#torrent-detail-content\").html($compile(html)($scope));\r\n            },\r\n            \"loopGetDetail\":function () {\r\n                $scope.pool.ajax.fullDetail = ajaxService.getFullDetail($scope.dataStorage.session, [$scope.dataStorage.torrent[$scope.dataStorage.selectedIndex].id]);\r\n                $scope.pool.ajax.fullDetail.promise.then(function(response) {\r\n\r\n                    $scope.dataStorage.detail = response.data.arguments.torrents[0];\r\n\r\n                    $scope.pool.loop.detail = setInterval(function() {\r\n                        $scope.pool.ajax.detail = ajaxService.getDetail($scope.dataStorage.session, [$scope.dataStorage.torrent[$scope.dataStorage.selectedIndex].id]);\r\n                        $scope.pool.ajax.detail.promise.then(function($response) {\r\n                            $scope.dataStorage.detail = _.merge($scope.dataStorage.detail, $response.data.arguments.torrents[0]);\r\n                        }, function(reason) {\r\n                            clearInterval($scope.pool.loop.detail);\r\n                            $scope.closeAjax($scope.pool.ajax.fullDetail);\r\n                            $scope.closeAjax($scope.pool.ajax.detail);\r\n                            $scope.modal.show({\r\n                                type:\"waring\",\r\n                                title:\"维护明细数据失败\",\r\n                                content:\"请检查您的网络是否顺畅，或点击重载尝试重新加载明细数据解决！\",\r\n                                btnText:{\r\n                                    submit:\"重载\"\r\n                                },\r\n                                btnType : 2,\r\n                                submitFunc : function () {\r\n                                    $scope.modal.close();\r\n                                    $scope.detail.loopGetDetail();\r\n                                }\r\n                            });\r\n                        });\r\n                    }, $scope.loopFragment.detail);\r\n\r\n                    if(_.every($scope.dataStorage.detail.fileStats, [\"priority\", 0]) === true){\r\n                        $scope.detail.allPriorityStatus = 0;\r\n                    }else if(_.every($scope.dataStorage.detail.fileStats, [\"priority\", -1]) === true){\r\n                        $scope.detail.allPriorityStatus = -1;\r\n                    }else if(_.every($scope.dataStorage.detail.fileStats, [\"priority\", 1]) === true){\r\n                        $scope.detail.allPriorityStatus = 1;\r\n                    }\r\n                }, function(reason) {\r\n                    $scope.modal.show({\r\n                        type:\"waring\",\r\n                        title:\"获取明细数据失败\",\r\n                        content:\"请检查您的网络是否顺畅！\",\r\n                        btnType : 1\r\n                    });\r\n                });\r\n            },\r\n            \"changePriority\":function (op) {\r\n                var params = {\r\n                    idsArr : [$scope.dataStorage.torrent[$scope.dataStorage.selectedIndex].id],\r\n                    priorityType:(function(){\r\n                        var str = \"\";\r\n                        switch (op.type){\r\n                            case -1:\r\n                                str = \"priority-low\";\r\n                                break;\r\n                            case 0:\r\n                                str = \"priority-normal\";\r\n                                break;\r\n                            case 1:\r\n                                str = \"priority-high\";\r\n                                break;\r\n                        }\r\n                        return str;\r\n                    })(),\r\n                    priorityIndexArr:(function () {\r\n                        var arr = [];\r\n                        if(op.index > -1){\r\n                            arr.push(op.index);\r\n                        }else{\r\n                            var l = $scope.dataStorage.detail.fileStats.length;\r\n                            for (var i =0;i<l;i++){\r\n                                arr.push(i);\r\n                            }\r\n                        }\r\n                        return arr;\r\n                    })()\r\n                };\r\n                ajaxService.setPriority($scope.dataStorage.session,params).then(function () {\r\n                    $scope.reload.detail();\r\n                },function (reason) {\r\n                    $scope.modal.show({\r\n                        type:\"waring\",\r\n                        title:\"设置文件优先级失败\",\r\n                        content:\"test\",\r\n                        size:\"small\",\r\n                        btnType : 1\r\n                    });\r\n                });\r\n            },\r\n            \"show\": function() {\r\n                $scope.detail.status = $scope.detail.status !== true;\r\n\r\n                if ($scope.detail.status === true) {\r\n                    if ($scope.dataStorage.selectedIndex !== '') {\r\n                        $scope.detail.torrentData = $scope.dataStorage.torrent[$scope.dataStorage.selectedIndex];\r\n\r\n                        require([\"echarts\"],function(echarts){\r\n                            //显示图表\r\n                            $scope.echartsLoaded = true;\r\n\r\n                            //加载图表数据\r\n                            if($scope.speedChart === undefined){\r\n                                //第一次加载图表\r\n                                var options = {\r\n                                    title: {\r\n                                        text: \"堆叠区域图\",\r\n                                        show:false\r\n                                    },\r\n                                    tooltip : {\r\n                                        show:false,\r\n                                        trigger: \"axis\"\r\n                                    },\r\n                                    legend: {\r\n                                        show:false\r\n                                    },\r\n                                    toolbox: {\r\n                                        show:false,\r\n                                        feature: {\r\n                                            saveAsImage: {}\r\n                                        }\r\n                                    },\r\n                                    grid: {\r\n                                        top:20,\r\n                                        left: \"-14.29%\",\r\n                                        right: 0,\r\n                                        bottom: 20,\r\n                                        containLabel: false\r\n                                    },\r\n                                    xAxis : [\r\n                                        {\r\n                                            type : \"category\",\r\n                                            splitLine:{\r\n                                                show:false\r\n                                            },\r\n                                            axisLine:{\r\n                                                lineStyle:{\r\n                                                    color:\"#FFF\"\r\n                                                }\r\n                                            },\r\n                                            axisTick:{\r\n                                                show:false\r\n                                            },\r\n                                            axisLabel:{\r\n                                                textStyle:{\r\n                                                    color: \"#888\"\r\n                                                }\r\n                                            },\r\n                                            boundaryGap : false\r\n                                        }\r\n                                    ],\r\n                                    yAxis : [\r\n                                        {\r\n                                            type : \"value\",\r\n                                            splitNumber:0,\r\n                                            minInterval:0,\r\n                                            silent:true,\r\n                                            splitLine:{\r\n                                                show:false\r\n                                            },\r\n                                            axisLine:{\r\n                                                show:false\r\n                                            },\r\n                                            axisTick:{\r\n                                                show:false\r\n                                            },\r\n                                            axisLabel:{\r\n                                                show:false\r\n                                            },\r\n                                            // max:$scope.dataStorage.global[\"alt-speed-down\"],\r\n                                            min:0\r\n                                        }, {\r\n                                            type : \"value\",\r\n                                            splitNumber:0,\r\n                                            minInterval:0,\r\n                                            silent:true,\r\n                                            splitLine:{\r\n                                                show:false\r\n                                            },\r\n                                            axisLine:{\r\n                                                show:false\r\n                                            },\r\n                                            axisTick:{\r\n                                                show:false\r\n                                            },\r\n                                            axisLabel:{\r\n                                                show:false\r\n                                            },\r\n                                            // max:$scope.dataStorage.global[\"alt-speed-up\"],\r\n                                            min:0\r\n                                        }\r\n                                    ],\r\n                                    series : [\r\n                                        {\r\n                                            name:\"下载速度\",\r\n                                            type:\"line\",\r\n                                            smooth:true,\r\n                                            showAllSymbol:false,\r\n                                            areaStyle: {normal: {\r\n                                                color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [\r\n                                                    {\r\n                                                        offset: 0, color: \"rgba(71, 121, 189, 1)\" // 0% 处的颜色\r\n                                                    }, {\r\n                                                        offset: 1, color: \"rgba(71, 121, 189, 0)\" // 100% 处的颜色\r\n                                                    }], false)\r\n                                            }},\r\n                                            showSymbol:true,\r\n                                            itemStyle:{\r\n                                                normal:{\r\n                                                    opacity:0\r\n                                                }\r\n                                            },\r\n                                            lineStyle :{\r\n                                                normal:{\r\n                                                    color:\"#4779bd\"\r\n                                                }\r\n                                            }\r\n                                        },\r\n                                        {\r\n                                            name:\"上传速度\",\r\n                                            type:\"line\",\r\n                                            smooth:true,\r\n                                            showAllSymbol:false,\r\n                                            areaStyle: {normal: {\r\n                                                color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [\r\n                                                    {\r\n                                                        offset: 0, color: \"rgba(52,203,208, 1)\" // 0% 处的颜色\r\n                                                    }, {\r\n                                                        offset: 1, color: \"rgba(52,203,208, 0)\" // 100% 处的颜色\r\n                                                    }], false)\r\n                                            }},\r\n                                            showSymbol:false,\r\n                                            itemStyle:{\r\n                                                normal:{\r\n                                                    opacity:0\r\n                                                }\r\n                                            },\r\n                                            lineStyle :{\r\n                                                normal:{\r\n                                                    color:\"#34cbd0\"\r\n                                                }\r\n                                            }\r\n                                        }\r\n                                    ]\r\n                                };\r\n                                var partOfData = $scope.initPartOfChartData($scope.detail.torrentData);\r\n                                options = _.merge(options,partOfData);\r\n                                $scope.$apply(function(){\r\n                                    $timeout(function(){\r\n                                        if($scope.speedChart === undefined){\r\n                                            $scope.speedChart = echarts.init(document.getElementById(\"download-speed-chart\"));\r\n                                            $scope.speedChart.setOption(options);\r\n                                            $scope.speedChartData.xAxis = options.xAxis[0].data;\r\n                                            $scope.speedChartData.download = options.series[0].data;\r\n                                            $scope.speedChartData.upload = options.series[1].data;\r\n                                            $(window).resize(function () {\r\n                                                $scope.speedChart.resize();\r\n                                            });\r\n                                        }\r\n                                        console.log($scope.speedChartData);\r\n                                    });\r\n                                });\r\n                            }else{\r\n                                //切换下载任务时重新初始化图表数据\r\n                                var $partOfData = $scope.initPartOfChartData($scope.detail.torrentData);\r\n                                $scope.speedChart.setOption($partOfData);\r\n                                $scope.speedChartData.xAxis = $partOfData.xAxis[0].data;\r\n                                $scope.speedChartData.download = $partOfData.series[0].data;\r\n                                $scope.speedChartData.upload = $partOfData.series[1].data;\r\n                            }\r\n                        },function(){\r\n                            console.log(\"echarts load fail!\");\r\n                        });\r\n                        $scope.detail.loopGetDetail();\r\n                    }\r\n                } else {\r\n                    $scope.detail.close();\r\n                }\r\n            },\r\n            \"dbshow\":function ($event,index) {\r\n                if($scope.getScreenWidth() > 1024){\r\n                    $scope.nav.close();\r\n                    $scope.detail.show();\r\n                }\r\n            },\r\n            \"close\": function() {\r\n                $scope.detail.status = false;\r\n                clearInterval($scope.pool.loop.detail);\r\n                $scope.closeAjax($scope.pool.ajax.fullDetail);\r\n                $scope.closeAjax($scope.pool.ajax.detail);\r\n            },\r\n            \"parseErrorText\":function () {\r\n                var str = \"\";\r\n                switch ($scope.detail.torrentData.error){\r\n                    case 0:\r\n                        str = \"无错误\";\r\n                        break;\r\n                    case 1:\r\n                        str = \"Tracker服务器告警\";\r\n                        break;\r\n                    case 2:\r\n                        str = \"Tracker服务器错误\";\r\n                        break;\r\n                    case 3:\r\n                        str = \"本地错误\";\r\n                        break;\r\n                    default:\r\n                        str = $scope.detail.torrentData.errorString;\r\n                        break;\r\n                }\r\n\r\n                return str;\r\n            }\r\n        };\r\n\r\n        $scope.setting = {\r\n            show:function () {\r\n                $scope.modal.show({\r\n                    type:\"window\",\r\n                    btnType : 2,\r\n                    submitFunc : function () {\r\n                        $window.location.reload();\r\n                    }\r\n                });\r\n            }\r\n        };\r\n\r\n        $scope.closeAjax = function(obj) {\r\n            if (typeof obj === \"object\" && typeof obj.resolve === \"function\") {\r\n                obj.resolve();\r\n            }\r\n        };\r\n\r\n        $scope.reload = {\r\n            \"session\":function () {\r\n                clearInterval($scope.pool.loop.session);\r\n                $scope.closeAjax($scope.pool.ajax.session);\r\n                $scope.closeAjax($scope.pool.ajax.sessionStats);\r\n                $scope.loopGetSession();\r\n            },\r\n            \"torrent\": function() {\r\n                clearInterval($scope.pool.loop.activeTorrent);\r\n                $scope.closeAjax($scope.pool.ajax.torrent);\r\n                $scope.closeAjax($scope.pool.ajax.activeTorrent);\r\n                $scope.loopGetTorrentData();\r\n            },\r\n            \"detail\": function() {\r\n                clearInterval($scope.pool.loop.detail);\r\n                $scope.closeAjax($scope.pool.ajax.fullDetail);\r\n                $scope.closeAjax($scope.pool.ajax.detail);\r\n                $scope.detail.loopGetDetail();\r\n            }\r\n        };\r\n\r\n        $scope.isAllLoaded = function () {\r\n            return $scope.allLoaded;\r\n        };\r\n\r\n        //验证传入的ID数组是是否为空\r\n        var validationIDS = function(ids) {\r\n            var result = true;\r\n            if ($scope.dataStorage.torrent.length === 0 || ids === undefined || ids.length === 0 || (ids.length === 1 && ids[0] === undefined)) {\r\n                result = false;\r\n            }\r\n\r\n            //如果是移动设备则直接设置为关闭侧边栏\r\n            if ($(window).width() <= 1024) {\r\n                $scope.consolePanel.status = false;\r\n            }\r\n\r\n            return result;\r\n        };\r\n\r\n        $scope.addTransform = function ($event) {\r\n\r\n            if($scope.isAllLoaded() === false) {\r\n                return false;\r\n            }\r\n\r\n            $scope.dataStorage.addTransform[\"download-dir\"] = $scope.dataStorage.global[\"download-dir\"];\r\n            $event.stopPropagation();\r\n            $scope.modal.show({\r\n                type:\"add\",\r\n                size:\"big\",\r\n                title:\"添加任务\",\r\n                btnText:{\r\n                    submit:\"添加\"\r\n                },\r\n                tmp:$scope.tmpUrl.addFiles,\r\n                submitFunc:function () {\r\n                    $scope.modal.close();\r\n                    var filename = $(\"#addTorrentUrl\")[0].value;\r\n                    if(filename !== \"\" && filename !== undefined && filename !== null){\r\n                        var params = {\r\n                            \"paused\": $scope.dataStorage.addTransform.paused !== true,\r\n                            \"download-dir\": $scope.dataStorage.addTransform[\"download-dir\"],\r\n                            \"filename\": filename\r\n                        };\r\n\r\n                        ajaxService.addTransform($scope.dataStorage.session,params).then(function () {\r\n                            $scope.reload.torrent();\r\n                            $scope.reload.session();\r\n                        },function (reason) {\r\n                            $scope.modal.show({\r\n                                type:\"waring\",\r\n                                title:\"任务添加失败\",\r\n                                content:filename,\r\n                                size:\"small\",\r\n                                btnType : 1\r\n                            });\r\n                        });\r\n                    }else{\r\n                        var arr = [];\r\n                        var files = $(\"#addTorrentFiles\")[0].files;\r\n                        var err = [];\r\n                        var promiseFlag = false;\r\n                        var errFlag = false;\r\n                        _.each(files,function (value, $index) {\r\n                            var reader = new FileReader();\r\n                            reader.onload = function(e) {\r\n                                var contents = e.target.result;\r\n                                var key = \"base64,\";\r\n                                var index = contents.indexOf (key);\r\n                                if (index > -1) {\r\n                                    var metainfo = contents.substring (index + key.length);\r\n                                    var params = {\r\n                                        \"paused\": $scope.dataStorage.addTransform.paused !== true,\r\n                                        \"download-dir\": $scope.dataStorage.addTransform[\"download-dir\"],\r\n                                        \"metainfo\": metainfo\r\n                                    };\r\n\r\n                                    arr[$index] = ajaxService.addTransform($scope.dataStorage.session,params).then(function () {\r\n                                        if(arr.length === files.length && promiseFlag === false){\r\n                                            setTimeout(function () {\r\n                                                $scope.reload.torrent();\r\n                                                $scope.reload.session();\r\n                                            },3000);\r\n                                            promiseFlag = true;\r\n                                        }\r\n                                    },function (reason) {\r\n                                        if(arr.length === files.length && errFlag === false){\r\n                                            errFlag = true;\r\n                                            $scope.modal.show({\r\n                                                type:\"waring\",\r\n                                                title:\"任务添加失败\",\r\n                                                content:err.join(\";\"),\r\n                                                size:\"small\",\r\n                                                btnType : 1\r\n                                            });\r\n                                        }else{\r\n                                            err[$index] = value.name + reason.data.result;\r\n                                        }\r\n                                    });\r\n                                }\r\n                            };\r\n                            reader.readAsDataURL (value);\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n        };\r\n\r\n        $scope.removeFromList = function(ids) {\r\n            if (validationIDS(ids) === false) {\r\n                return false;\r\n            }\r\n            // $scope.dataStorage.session\r\n            $scope.modal.show({\r\n                type:\"waring\",\r\n                title:\"确定要从传输任务列表中删除\"+ (ids.length > 1?\"这些\":\"此\") +\"任务吗？\",\r\n                content:ids.length > 1?\"已选中多个任务\":$scope.dataStorage.torrent[$scope.dataStorage.selectedIndex].name,\r\n                btnType : 2,\r\n                btnText:{\r\n                    submit:\"删除\"\r\n                },\r\n                submitFunc:function () {\r\n                    $scope.modal.close();\r\n                    ajaxService.removeFromList($scope.dataStorage.session, ids).then(function(response) {\r\n                        $scope.reload.torrent();\r\n                    }, function(reason) {\r\n                        $scope.modal.show({\r\n                            type:\"waring\",\r\n                            title:\"从下载列表中移除任务失败\",\r\n                            content:\"请检查您的网络是否顺畅！\",\r\n                            btnType : 1\r\n                        });\r\n                    });\r\n                }\r\n            });\r\n        };\r\n\r\n        $scope.pauseTransform = function(ids) {\r\n            if (validationIDS(ids) === false) {\r\n                return false;\r\n            }\r\n            ajaxService.pauseTransform($scope.dataStorage.session, ids).then(function(response) {\r\n                $scope.reload.torrent();\r\n            }, function(reason) {\r\n                $scope.modal.show({\r\n                    type:\"waring\",\r\n                    title:\"暂停传输任务请求失败！\",\r\n                    content:\"请检查您的网络是否顺畅！\",\r\n                    btnType : 1\r\n                });\r\n            });\r\n        };\r\n\r\n        $scope.startTransform = function(ids) {\r\n            if (validationIDS(ids) === false) {\r\n                return false;\r\n            }\r\n            ajaxService.startTransform($scope.dataStorage.session, ids).then(function(response) {\r\n                $scope.reload.torrent();\r\n            }, function(reason) {\r\n                $scope.modal.show({\r\n                    type:\"waring\",\r\n                    title:\"开始传输任务请求失败！\",\r\n                    content:\"请检查您的网络是否顺畅！\",\r\n                    btnType : 1\r\n                });\r\n            });\r\n        };\r\n\r\n        $scope.startTransformNow = function(ids) {\r\n            if (validationIDS(ids) === false) {\r\n                return false;\r\n            }\r\n            ajaxService.startTransformNow($scope.dataStorage.session, ids).then(function(response) {\r\n                $scope.reload.torrent();\r\n            }, function(reason) {\r\n                $scope.modal.show({\r\n                    type:\"waring\",\r\n                    title:\"立即开始传输任务请求失败！\",\r\n                    content:\"请检查您的网络是否顺畅！\",\r\n                    size:\"small\",\r\n                    btnType : 1\r\n                });\r\n            });\r\n        };\r\n\r\n        $scope.submitSettings = function (params) {\r\n            ajaxService.saveSettings($scope.dataStorage.session, params).then(function(response) {\r\n                $scope.modal.status = false;\r\n                $scope.getStatsData();\r\n                $scope.reload.session();\r\n            }, function(reason) {\r\n                $scope.modal.show({\r\n                    type:\"waring\",\r\n                    title:\"保存设置失败！\",\r\n                    content:\"请检查您的网络是否顺畅，或点击重试再尝试一次！\",\r\n                    size:\"small\",\r\n                    btnText:{\r\n                        submit:\"重试\"\r\n                    },\r\n                    btnType : 2,\r\n                    submitFunc:function () {\r\n                        $scope.submitSettings(params);\r\n                    }\r\n                });\r\n            });\r\n        };\r\n\r\n        $scope.consolePanel = {\r\n            status: false,\r\n            show: function() {\r\n                $scope.consolePanel.status = true;\r\n            },\r\n            close: function() {\r\n                $scope.consolePanel.status = false;\r\n            }\r\n        };\r\n\r\n        $scope.modal = {\r\n            \"status\":false,\r\n            \"isNeedTitle\":false,\r\n            \"type\":\"add\",//tip,waring,delete,add,window\r\n            \"size\":\"small\",\r\n            \"title\":\"添加传输任务失败\",\r\n            \"content\":\"请检查你的网络，或者尝试重新添加一次！\",\r\n            \"btnType\":2,//0 只有确定按钮，1 只有取消按钮，2 两个都有\r\n            \"tempatesUrl\":\"template/modals.html\",\r\n            \"tmp\":\"\",\r\n            \"btnText\":{\r\n                \"submit\":\"确定\",\r\n                \"cancel\":\"关闭\"\r\n            },\r\n            \"submitFunc\":function () {\r\n                $scope.modal.close();\r\n            },\r\n            \"show\":function (op) {\r\n                if(op !== undefined && op.$event!==null && op.$event!==undefined){\r\n                    op.$event.stopPropagation();\r\n                }\r\n\r\n                if($scope.modal.status === true){return false;}\r\n\r\n                $scope.modal.size = op.size === undefined?\"small\":op.size;\r\n\r\n                if(!op.btnText){\r\n                    op.btnText = {\r\n                        submit:\"确定\",\r\n                        cancel:\"关闭\"\r\n                    };\r\n                }else{\r\n                    op.btnText.submit = (op.btnText.submit === \"\" || !op.btnText.submit)?\"确定\":op.btnText.submit;\r\n                    op.btnText.cancel = (op.btnText.cancel === \"\" || !op.btnText.cancel)?\"关闭\":op.btnText.cancel;\r\n                }\r\n\r\n                $scope.modal.tmp = op.tmp !== undefined?op.tmp:$scope.tmpUrl.modal;\r\n\r\n                var html = $(\"#\"+ $scope.modal.tmp).html();\r\n                $(\"#modal\").html($compile(html)($scope));\r\n\r\n                var className = \"alpha\";\r\n\r\n                if(op !== undefined){\r\n                    _.each(op,function (value,key) {\r\n                        if(key !== \"show\" && key !== \"close\" && key !== \"status\"){\r\n                            $scope.modal[key] = value;\r\n                        }\r\n                    });\r\n                }\r\n\r\n                $scope.modal.status = $scope.modal.status !== true;\r\n\r\n                $timeout(function () {\r\n                    $(\"#modal-bg\").addClass(className);\r\n                    $(\"#modal\").addClass(className);\r\n                },100);\r\n            },\r\n            \"close\":function () {\r\n                var className = \"alpha\";\r\n\r\n                $(\"#modal-bg\").removeClass(className);\r\n                $(\"#modal\").removeClass(className);\r\n\r\n                $timeout(function () {\r\n                    $scope.modal.status = false;\r\n                    $scope.modal.tmp = \"\";\r\n                },233);\r\n            },\r\n            \"selectTagContent\":function ($index) {\r\n                return $scope.tag.index === $index;\r\n            }\r\n        };\r\n\r\n        $scope.tag = {\r\n            \"name\":[\"种子\",\"速度\",\"用户\",\"网络\"],\r\n            \"index\":0,\r\n            \"swipLeft\":function () {\r\n                if($scope.tag.index < 3){\r\n                    $scope.tag.index += 1;\r\n                }\r\n            },\r\n            \"swipRight\":function () {\r\n                if($scope.tag.index > 0){\r\n                    $scope.tag.index -= 1;\r\n                }\r\n            },\r\n            \"toggle\":function ($index) {\r\n                // var contents = $(\"#modal .tag-content\");\r\n                $scope.tag.index = $index;\r\n                // contents.eq($index).addClass(\"selected\").siblings().removeClass(\"selected\");\r\n            }\r\n        };\r\n\r\n        $scope.nav = {\r\n            status:false,\r\n            menudata:{\r\n                name:[\"设置\",\"计划任务运行\",\"收缩视图\",\"查看传输明细\",\"统计\",\"关于\"],\r\n                className:[\"icon-settings\",\"icon-scheduled\",\"icon-listview\",\"icon-info-black\",\"icon-data_usage\",\"icon-goat\"]\r\n            },\r\n            toggle:function () {\r\n                if($scope.allLoaded === false){\r\n                    return false;\r\n                }\r\n                $scope.nav.status = $scope.nav.status !== true;\r\n            },\r\n            show:function () {\r\n                $scope.nav.status = true;\r\n            },\r\n            close:function ($event,index) {\r\n                if($event){\r\n                    $event.stopPropagation();\r\n                }\r\n\r\n                $scope.nav.status = false;\r\n\r\n                switch (index){\r\n                    case 0:\r\n                        $scope.dataStorage.settings = angular.copy($scope.dataStorage.global);\r\n\r\n                        ajaxService.portTest($scope.dataStorage.session).then(function (response) {\r\n                            $scope.dataStorage[\"port-test\"] = response.data[\"arguments\"][\"port-is-open\"];\r\n                        },function (reason) {\r\n                            $scope.modal.show({\r\n                                type:\"waring\",\r\n                                title:\"端口是否开启检测失败\",\r\n                                content:\"请检查您的网络是否顺畅！\",\r\n                                btnType : 1\r\n                            });\r\n                        });\r\n                        $scope.modal.show({\r\n                            type:\"setting\",\r\n                            size:\"size-window\",\r\n                            tmp:$scope.tmpUrl.settings,\r\n                            btnType : 2,\r\n                            btnText:{\r\n                                submit:\"保存\"\r\n                            },\r\n                            submitFunc : function () {\r\n                                var param = {};\r\n                                _.each($scope.dataStorage.settings,function (value,key) {\r\n                                    var type = typeof ($scope.dataStorage.global[key]);\r\n                                    value = type === \"number\"?parseFloat(value):value;\r\n                                    if(value !== $scope.dataStorage.global[key] && key !== \"units\"){\r\n                                        param[key] = value;\r\n                                    }\r\n                                });\r\n                                $scope.submitSettings(param);\r\n                            }\r\n                        });\r\n                        break;\r\n                    case 1:\r\n                        var params = {\"alt-speed-enabled\":$scope.dataStorage.global[\"alt-speed-enabled\"] !== true};\r\n                        ajaxService.saveSettings($scope.dataStorage.session, params).then(function(response) {\r\n                            $scope.reload.session();\r\n                        }, function(reason) {\r\n                            $scope.modal.show({\r\n                                type:\"waring\",\r\n                                title:(params[\"alt-speed-enabled\"] === true?\"打开\":\"关闭\") + \"计划任务失败！\",\r\n                                content:\"请检查您的网络是否顺畅，或点击确定再此尝试保存！\",\r\n                                btnType : 1\r\n                            });\r\n                        });\r\n                        break;\r\n                    case 3:\r\n                        $scope.detail.show();\r\n                        break;\r\n                    case 4:\r\n                        $scope.modal.show({\r\n                            type:\"statics\",\r\n                            size:\"big\",\r\n                            tmp:$scope.tmpUrl.statics,\r\n                            btnType : 1\r\n                        });\r\n                        break;\r\n                    case 5:\r\n                        $scope.modal.show({\r\n                            type:\"about\",\r\n                            size:\"big\",\r\n                            tmp:$scope.tmpUrl.about,\r\n                            btnType : 1\r\n                        });\r\n                        break;\r\n                }\r\n            },\r\n            parseMenuVisible:function ($index) {\r\n                return ($index < 3);\r\n            }\r\n        };\r\n\r\n        $scope.getTotalSpeed = function () {\r\n            var result = {\r\n                download:0,\r\n                upload:0\r\n            };\r\n\r\n            _.each($scope.dataStorage.torrent,function (obj,index) {\r\n                result.download += (obj.rateDownload === undefined || obj.rateDownload === null) ? 0 :obj.rateDownload;\r\n                result.upload += (obj.rateUpload === undefined || obj.rateUpload === null) ? 0 :obj.rateUpload;\r\n            });\r\n\r\n            $scope.dataStorage.totalSpeed.download = result.download;\r\n            $scope.dataStorage.totalSpeed.upload = result.upload;\r\n        };\r\n\r\n        $scope.getScreenWidth = function () {\r\n            return $(window).width();\r\n        };\r\n\r\n        $scope.stopAllAjax = function () {\r\n            _.each($scope.pool.loop,function (value,key) {\r\n                clearInterval($scope.pool.loop[key]);\r\n            });\r\n            _.each($scope.pool.ajax,function (value,key) {\r\n                $scope.closeAjax($scope.pool.ajax[key]);\r\n            });\r\n        };\r\n\r\n        $scope.init = function() {\r\n            var detailTemplateLoad = $scope.$watch(\"detailTemplateLoaded\",function (newValue,oldValue) {\r\n                if(newValue === true && oldValue === false){\r\n                    $scope.detail.compileTemplate();\r\n                    detailTemplateLoad();\r\n                }\r\n            },true);\r\n            // if($scope.getScreenWidth() >= 1024){\r\n                // var doc = window.document;\r\n                // var docEl = doc.documentElement;\r\n                //\r\n                // var requestFullScreen = docEl.requestFullscreen || docEl.mozRequestFullScreen || docEl.webkitRequestFullScreen || docEl.msRequestFullscreen;\r\n                // var cancelFullScreen = doc.exitFullscreen || doc.mozCancelFullScreen || doc.webkitExitFullscreen || doc.msExitFullscreen;\r\n                //\r\n                // if(!doc.fullscreenElement && !doc.mozFullScreenElement && !doc.webkitFullscreenElement && !doc.msFullscreenElement) {\r\n                //     requestFullScreen.call(docEl);\r\n                // }\r\n                // else {\r\n                //     cancelFullScreen.call(doc);\r\n                // }\r\n            // }\r\n\r\n            //load local data\r\n            $scope.localMode = false;\r\n\r\n            if ($scope.localMode === true) {\r\n                var deferred = $q.defer();\r\n\r\n                require([\"localData\"], function(localData) {\r\n                    deferred.resolve(localData);\r\n                });\r\n\r\n                deferred.promise.then(function(response) {\r\n                    $scope.dataStorage = {\r\n                        global: response.global,\r\n                        torrent: response.torrent,\r\n                        selectedIndex: response.selectedIndex,\r\n                        stats: response.stats,\r\n                        ids: response.ids,\r\n                        detail: response.detail\r\n                    };\r\n\r\n                    $scope.getTotalSpeed();\r\n                }, function(reason) {\r\n\r\n                });\r\n            }\r\n\r\n            //连续获取seesion\r\n            $scope.pool.loop.session = setInterval(function() {\r\n                $scope.getSession();\r\n            }, 3000);\r\n\r\n            //获取到session后结束循环获取session\r\n            $scope.$on(\"getSessionDone\", function(event) {\r\n                clearInterval($scope.pool.loop.session);\r\n                //获取总的下载和上传速度\r\n                $scope.getStatsData(\"init\");\r\n\r\n                //轮询session数据，以避免丢失session\r\n                $scope.loopGetSession();\r\n            });\r\n\r\n            $scope.$on(\"getStatsDone\", function() {\r\n                $scope.loopGetTorrentData();\r\n            });\r\n\r\n            $scope.allLoaded = false;\r\n\r\n            $scope.echartsLoaded = false;\r\n\r\n            $scope.speedChart = undefined;\r\n\r\n            document.addEventListener(\"touchstart\", function(event) {\r\n                // 判断默认行为是否可以被禁用\r\n                if (event.cancelable) {\r\n                    // 判断默认行为是否已经被禁用\r\n                    if (!event.defaultPrevented) {\r\n                        event.preventDefault();\r\n                    }\r\n                }\r\n            }, false);\r\n        };\r\n\r\n        $scope.init();\r\n\r\n    }]);\r\n\r\n    //inlclude 直接用被嵌套的HTML替换include所在的标签\r\n    $app.directive(\"includeReplace\", function() {\r\n        return {\r\n            require: \"ngInclude\",\r\n            restrict: \"A\",\r\n            /* optional */\r\n            link: function(scope, el, attrs) {\r\n                el.replaceWith(el.children());\r\n            }\r\n        };\r\n    });\r\n\r\n    return $app;\r\n});\r\n"]}